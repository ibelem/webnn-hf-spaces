(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))n(u);new MutationObserver(u=>{for(const c of u)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function s(u){const c={};return u.integrity&&(c.integrity=u.integrity),u.referrerPolicy&&(c.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?c.credentials="include":u.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(u){if(u.ep)return;u.ep=!0;const c=s(u);fetch(u.href,c)}})();var wn=Object.defineProperty,Nl=Object.getOwnPropertyDescriptor,Wl=Object.getOwnPropertyNames,Gl=Object.prototype.hasOwnProperty,Fl=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(a,s)=>(typeof require<"u"?require:a)[s]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')}),W=(r,a)=>()=>(r&&(a=r(r=0)),a),jt=(r,a)=>{for(var s in a)wn(r,s,{get:a[s],enumerable:!0})},Vl=(r,a,s,n)=>{if(a&&typeof a=="object"||typeof a=="function")for(let u of Wl(a))!Gl.call(r,u)&&u!==s&&wn(r,u,{get:()=>a[u],enumerable:!(n=Nl(a,u))||n.enumerable});return r},ar=r=>Vl(wn({},"__esModule",{value:!0}),r),At,Ze,yt,sa,$a,ja=W(()=>{At=new Map,Ze=[],yt=(r,a,s)=>{if(a&&typeof a.init=="function"&&typeof a.createInferenceSessionHandler=="function"){let n=At.get(r);if(n===void 0)At.set(r,{backend:a,priority:s});else{if(n.priority>s)return;if(n.priority===s&&n.backend!==a)throw new Error(`cannot register backend "${r}" using priority ${s}`)}if(s>=0){let u=Ze.indexOf(r);u!==-1&&Ze.splice(u,1);for(let c=0;c<Ze.length;c++)if(At.get(Ze[c]).priority<=s){Ze.splice(c,0,r);return}Ze.push(r)}return}throw new TypeError("not a valid backend")},sa=async r=>{let a=At.get(r);if(!a)return"backend not found.";if(a.initialized)return a.backend;if(a.aborted)return a.error;{let s=!!a.initPromise;try{return s||(a.initPromise=a.backend.init(r)),await a.initPromise,a.initialized=!0,a.backend}catch(n){return s||(a.error=`${n}`,a.aborted=!0),a.error}finally{delete a.initPromise}}},$a=async r=>{let a=r.executionProviders||[],s=a.map(m=>typeof m=="string"?m:m.name),n=s.length===0?Ze:s,u,c=[],d=new Set;for(let m of n){let g=await sa(m);typeof g=="string"?c.push({name:m,err:g}):(u||(u=g),u===g&&d.add(m))}if(!u)throw new Error(`no available backend found. ERR: ${c.map(m=>`[${m.name}] ${m.err}`).join(", ")}`);for(let{name:m,err:g}of c)s.includes(m)&&console.warn(`removing requested execution provider "${m}" from session options because it is not available: ${g}`);let p=a.filter(m=>d.has(typeof m=="string"?m:m.name));return[u,new Proxy(r,{get:(m,g)=>g==="executionProviders"?p:Reflect.get(m,g)})]}}),zl=W(()=>{ja()}),Da,Hl=W(()=>{Da="1.23.2"}),Nr,fe,ka=W(()=>{Hl(),Nr="warning",fe={wasm:{},webgl:{},webgpu:{},versions:{common:Da},set logLevel(r){if(r!==void 0){if(typeof r!="string"||["verbose","info","warning","error","fatal"].indexOf(r)===-1)throw new Error(`Unsupported logging level: ${r}`);Nr=r}},get logLevel(){return Nr}},Object.defineProperty(fe,"logLevel",{enumerable:!0})}),ee,ql=W(()=>{ka(),ee=fe}),Na,Wa,Zl=W(()=>{Na=(r,a)=>{let s=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);s.width=r.dims[3],s.height=r.dims[2];let n=s.getContext("2d");if(n!=null){let u,c;a?.tensorLayout!==void 0&&a.tensorLayout==="NHWC"?(u=r.dims[2],c=r.dims[3]):(u=r.dims[3],c=r.dims[2]);let d=a?.format!==void 0?a.format:"RGB",p=a?.norm,m,g;p===void 0||p.mean===void 0?m=[255,255,255,255]:typeof p.mean=="number"?m=[p.mean,p.mean,p.mean,p.mean]:(m=[p.mean[0],p.mean[1],p.mean[2],0],p.mean[3]!==void 0&&(m[3]=p.mean[3])),p===void 0||p.bias===void 0?g=[0,0,0,0]:typeof p.bias=="number"?g=[p.bias,p.bias,p.bias,p.bias]:(g=[p.bias[0],p.bias[1],p.bias[2],0],p.bias[3]!==void 0&&(g[3]=p.bias[3]));let v=c*u,C=0,T=v,I=v*2,O=-1;d==="RGBA"?(C=0,T=v,I=v*2,O=v*3):d==="RGB"?(C=0,T=v,I=v*2):d==="RBG"&&(C=0,I=v,T=v*2);for(let $=0;$<c;$++)for(let S=0;S<u;S++){let A=(r.data[C++]-g[0])*m[0],P=(r.data[T++]-g[1])*m[1],D=(r.data[I++]-g[2])*m[2],L=O===-1?255:(r.data[O++]-g[3])*m[3];n.fillStyle="rgba("+A+","+P+","+D+","+L+")",n.fillRect(S,$,1,1)}if("toDataURL"in s)return s.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},Wa=(r,a)=>{let s=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),n;if(s!=null){let u,c,d;a?.tensorLayout!==void 0&&a.tensorLayout==="NHWC"?(u=r.dims[2],c=r.dims[1],d=r.dims[3]):(u=r.dims[3],c=r.dims[2],d=r.dims[1]);let p=a!==void 0&&a.format!==void 0?a.format:"RGB",m=a?.norm,g,v;m===void 0||m.mean===void 0?g=[255,255,255,255]:typeof m.mean=="number"?g=[m.mean,m.mean,m.mean,m.mean]:(g=[m.mean[0],m.mean[1],m.mean[2],255],m.mean[3]!==void 0&&(g[3]=m.mean[3])),m===void 0||m.bias===void 0?v=[0,0,0,0]:typeof m.bias=="number"?v=[m.bias,m.bias,m.bias,m.bias]:(v=[m.bias[0],m.bias[1],m.bias[2],0],m.bias[3]!==void 0&&(v[3]=m.bias[3]));let C=c*u;if(a!==void 0&&(a.format!==void 0&&d===4&&a.format!=="RGBA"||d===3&&a.format!=="RGB"&&a.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let T=4,I=0,O=1,$=2,S=3,A=0,P=C,D=C*2,L=-1;p==="RGBA"?(A=0,P=C,D=C*2,L=C*3):p==="RGB"?(A=0,P=C,D=C*2):p==="RBG"&&(A=0,D=C,P=C*2),n=s.createImageData(u,c);for(let N=0;N<c*u;I+=T,O+=T,$+=T,S+=T,N++)n.data[I]=(r.data[A++]-v[0])*g[0],n.data[O]=(r.data[P++]-v[1])*g[1],n.data[$]=(r.data[D++]-v[2])*g[2],n.data[S]=L===-1?255:(r.data[L++]-v[3])*g[3]}else throw new Error("Can not access image data");return n}}),Xt,Ga,Fa,Va,za,Ha,Xl=W(()=>{vn(),Xt=(r,a)=>{if(r===void 0)throw new Error("Image buffer must be defined");if(a.height===void 0||a.width===void 0)throw new Error("Image height and width must be defined");if(a.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:s,width:n}=a,u=a.norm??{mean:255,bias:0},c,d;typeof u.mean=="number"?c=[u.mean,u.mean,u.mean,u.mean]:c=[u.mean[0],u.mean[1],u.mean[2],u.mean[3]??255],typeof u.bias=="number"?d=[u.bias,u.bias,u.bias,u.bias]:d=[u.bias[0],u.bias[1],u.bias[2],u.bias[3]??0];let p=a.format!==void 0?a.format:"RGBA",m=a.tensorFormat!==void 0&&a.tensorFormat!==void 0?a.tensorFormat:"RGB",g=s*n,v=m==="RGBA"?new Float32Array(g*4):new Float32Array(g*3),C=4,T=0,I=1,O=2,$=3,S=0,A=g,P=g*2,D=-1;p==="RGB"&&(C=3,T=0,I=1,O=2,$=-1),m==="RGBA"?D=g*3:m==="RBG"?(S=0,P=g,A=g*2):m==="BGR"&&(P=0,A=g,S=g*2);for(let L=0;L<g;L++,T+=C,O+=C,I+=C,$+=C)v[S++]=(r[T]+d[0])/c[0],v[A++]=(r[I]+d[1])/c[1],v[P++]=(r[O]+d[2])/c[2],D!==-1&&$!==-1&&(v[D++]=(r[$]+d[3])/c[3]);return m==="RGBA"?new Ce("float32",v,[1,4,s,n]):new Ce("float32",v,[1,3,s,n])},Ga=async(r,a)=>{let s=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,n=typeof ImageData<"u"&&r instanceof ImageData,u=typeof ImageBitmap<"u"&&r instanceof ImageBitmap,c=typeof r=="string",d,p=a??{},m=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},g=v=>typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||v instanceof OffscreenCanvas?v.getContext("2d"):null;if(s){let v=m();v.width=r.width,v.height=r.height;let C=g(v);if(C!=null){let T=r.height,I=r.width;if(a!==void 0&&a.resizedHeight!==void 0&&a.resizedWidth!==void 0&&(T=a.resizedHeight,I=a.resizedWidth),a!==void 0){if(p=a,a.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");p.tensorFormat="RGBA",p.height=T,p.width=I}else p.tensorFormat="RGBA",p.height=T,p.width=I;C.drawImage(r,0,0),d=C.getImageData(0,0,I,T).data}else throw new Error("Can not access image data")}else if(n){let v,C;if(a!==void 0&&a.resizedWidth!==void 0&&a.resizedHeight!==void 0?(v=a.resizedHeight,C=a.resizedWidth):(v=r.height,C=r.width),a!==void 0&&(p=a),p.format="RGBA",p.height=v,p.width=C,a!==void 0){let T=m();T.width=C,T.height=v;let I=g(T);if(I!=null)I.putImageData(r,0,0),d=I.getImageData(0,0,C,v).data;else throw new Error("Can not access image data")}else d=r.data}else if(u){if(a===void 0)throw new Error("Please provide image config with format for Imagebitmap");let v=m();v.width=r.width,v.height=r.height;let C=g(v);if(C!=null){let T=r.height,I=r.width;return C.drawImage(r,0,0,I,T),d=C.getImageData(0,0,I,T).data,p.height=T,p.width=I,Xt(d,p)}else throw new Error("Can not access image data")}else{if(c)return new Promise((v,C)=>{let T=m(),I=g(T);if(!r||!I)return C();let O=new Image;O.crossOrigin="Anonymous",O.src=r,O.onload=()=>{T.width=O.width,T.height=O.height,I.drawImage(O,0,0,T.width,T.height);let $=I.getImageData(0,0,T.width,T.height);p.height=T.height,p.width=T.width,v(Xt($.data,p))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(d!==void 0)return Xt(d,p);throw new Error("Input data provided is not supported - aborted tensor creation")},Fa=(r,a)=>{let{width:s,height:n,download:u,dispose:c}=a,d=[1,n,s,4];return new Ce({location:"texture",type:"float32",texture:r,dims:d,download:u,dispose:c})},Va=(r,a)=>{let{dataType:s,dims:n,download:u,dispose:c}=a;return new Ce({location:"gpu-buffer",type:s??"float32",gpuBuffer:r,dims:n,download:u,dispose:c})},za=(r,a)=>{let{dataType:s,dims:n,download:u,dispose:c}=a;return new Ce({location:"ml-tensor",type:s??"float32",mlTensor:r,dims:n,download:u,dispose:c})},Ha=(r,a,s)=>new Ce({location:"cpu-pinned",type:r,data:a,dims:s??[a.length]})}),nt,Bt,Wr,qa,Yl=W(()=>{nt=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),Bt=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),Wr=!1,qa=()=>{if(!Wr){Wr=!0;let r=typeof BigInt64Array<"u"&&BigInt64Array.from,a=typeof BigUint64Array<"u"&&BigUint64Array.from,s=globalThis.Float16Array,n=typeof s<"u"&&s.from;r&&(nt.set("int64",BigInt64Array),Bt.set(BigInt64Array,"int64")),a&&(nt.set("uint64",BigUint64Array),Bt.set(BigUint64Array,"uint64")),n?(nt.set("float16",s),Bt.set(s,"float16")):nt.set("float16",Uint16Array)}}}),Za,Xa,Jl=W(()=>{vn(),Za=r=>{let a=1;for(let s=0;s<r.length;s++){let n=r[s];if(typeof n!="number"||!Number.isSafeInteger(n))throw new TypeError(`dims[${s}] must be an integer, got: ${n}`);if(n<0)throw new RangeError(`dims[${s}] must be a non-negative integer, got: ${n}`);a*=n}return a},Xa=(r,a)=>{switch(r.location){case"cpu":return new Ce(r.type,r.data,a);case"cpu-pinned":return new Ce({location:"cpu-pinned",data:r.data,type:r.type,dims:a});case"texture":return new Ce({location:"texture",texture:r.texture,type:r.type,dims:a});case"gpu-buffer":return new Ce({location:"gpu-buffer",gpuBuffer:r.gpuBuffer,type:r.type,dims:a});case"ml-tensor":return new Ce({location:"ml-tensor",mlTensor:r.mlTensor,type:r.type,dims:a});default:throw new Error(`tensorReshape: tensor location ${r.location} is not supported`)}}}),Ce,vn=W(()=>{Zl(),Xl(),Yl(),Jl(),Ce=class{constructor(r,a,s){qa();let n,u;if(typeof r=="object"&&"location"in r)switch(this.dataLocation=r.location,n=r.type,u=r.dims,r.location){case"cpu-pinned":{let d=nt.get(n);if(!d)throw new TypeError(`unsupported type "${n}" to create tensor from pinned buffer`);if(!(r.data instanceof d))throw new TypeError(`buffer should be of type ${d.name}`);this.cpuData=r.data;break}case"texture":{if(n!=="float32")throw new TypeError(`unsupported type "${n}" to create tensor from texture`);this.gpuTextureData=r.texture,this.downloader=r.download,this.disposer=r.dispose;break}case"gpu-buffer":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from gpu buffer`);this.gpuBufferData=r.gpuBuffer,this.downloader=r.download,this.disposer=r.dispose;break}case"ml-tensor":{if(n!=="float32"&&n!=="float16"&&n!=="int32"&&n!=="int64"&&n!=="uint32"&&n!=="uint64"&&n!=="int8"&&n!=="uint8"&&n!=="bool"&&n!=="uint4"&&n!=="int4")throw new TypeError(`unsupported type "${n}" to create tensor from MLTensor`);this.mlTensorData=r.mlTensor,this.downloader=r.download,this.disposer=r.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let d,p;if(typeof r=="string")if(n=r,p=s,r==="string"){if(!Array.isArray(a))throw new TypeError("A string tensor's data must be a string array.");d=a}else{let m=nt.get(r);if(m===void 0)throw new TypeError(`Unsupported tensor type: ${r}.`);if(Array.isArray(a)){if(r==="float16"&&m===Uint16Array||r==="uint4"||r==="int4")throw new TypeError(`Creating a ${r} tensor from number array is not supported. Please use ${m.name} as data.`);r==="uint64"||r==="int64"?d=m.from(a,BigInt):d=m.from(a)}else if(a instanceof m)d=a;else if(a instanceof Uint8ClampedArray)if(r==="uint8")d=Uint8Array.from(a);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(r==="float16"&&a instanceof Uint16Array&&m!==Uint16Array)d=new globalThis.Float16Array(a.buffer,a.byteOffset,a.length);else throw new TypeError(`A ${n} tensor's data must be type of ${m}`)}else if(p=a,Array.isArray(r)){if(r.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let m=typeof r[0];if(m==="string")n="string",d=r;else if(m==="boolean")n="bool",d=Uint8Array.from(r);else throw new TypeError(`Invalid element type of data array: ${m}.`)}else if(r instanceof Uint8ClampedArray)n="uint8",d=Uint8Array.from(r);else{let m=Bt.get(r.constructor);if(m===void 0)throw new TypeError(`Unsupported type for tensor data: ${r.constructor}.`);n=m,d=r}if(p===void 0)p=[d.length];else if(!Array.isArray(p))throw new TypeError("A tensor's dims must be a number array");u=p,this.cpuData=d,this.dataLocation="cpu"}let c=Za(u);if(this.cpuData&&c!==this.cpuData.length&&!((n==="uint4"||n==="int4")&&Math.ceil(c/2)===this.cpuData.length))throw new Error(`Tensor's size(${c}) does not match data length(${this.cpuData.length}).`);this.type=n,this.dims=u,this.size=c}static async fromImage(r,a){return Ga(r,a)}static fromTexture(r,a){return Fa(r,a)}static fromGpuBuffer(r,a){return Va(r,a)}static fromMLTensor(r,a){return za(r,a)}static fromPinnedBuffer(r,a,s){return Ha(r,a,s)}toDataURL(r){return Na(this,r)}toImageData(r){return Wa(this,r)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(r){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let a=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=a,r&&this.disposer&&(this.disposer(),this.disposer=void 0),a}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(r){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return Xa(this,r)}}}),Ae,Ya=W(()=>{vn(),Ae=Ce}),cn,Gr,wt,vt,at,ot,Ja=W(()=>{ka(),cn=(r,a)=>{(typeof fe.trace>"u"?!fe.wasm.trace:!fe.trace)||console.timeStamp(`${r}::ORT::${a}`)},Gr=(r,a)=>{let s=new Error().stack?.split(/\r\n|\r|\n/g)||[],n=!1;for(let u=0;u<s.length;u++){if(n&&!s[u].includes("TRACE_FUNC")){let c=`FUNC_${r}::${s[u].trim().split(" ")[1]}`;a&&(c+=`::${a}`),cn("CPU",c);return}s[u].includes("TRACE_FUNC")&&(n=!0)}},wt=r=>{(typeof fe.trace>"u"?!fe.wasm.trace:!fe.trace)||Gr("BEGIN",r)},vt=r=>{(typeof fe.trace>"u"?!fe.wasm.trace:!fe.trace)||Gr("END",r)},at=r=>{(typeof fe.trace>"u"?!fe.wasm.trace:!fe.trace)||console.time(`ORT::${r}`)},ot=r=>{(typeof fe.trace>"u"?!fe.wasm.trace:!fe.trace)||console.timeEnd(`ORT::${r}`)}}),Ka,Kl=W(()=>{ja(),Ya(),Ja(),Ka=class Qa{constructor(a){this.handler=a}async run(a,s,n){wt(),at("InferenceSession.run");let u={},c={};if(typeof a!="object"||a===null||a instanceof Ae||Array.isArray(a))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let d=!0;if(typeof s=="object"){if(s===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(s instanceof Ae)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(s)){if(s.length===0)throw new TypeError("'fetches' cannot be an empty array.");d=!1;for(let g of s){if(typeof g!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(g)===-1)throw new RangeError(`'fetches' contains invalid output name: ${g}.`);u[g]=null}if(typeof n=="object"&&n!==null)c=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else{let g=!1,v=Object.getOwnPropertyNames(s);for(let C of this.outputNames)if(v.indexOf(C)!==-1){let T=s[C];(T===null||T instanceof Ae)&&(g=!0,d=!1,u[C]=T)}if(g){if(typeof n=="object"&&n!==null)c=n;else if(typeof n<"u")throw new TypeError("'options' must be an object.")}else c=s}}else if(typeof s<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let g of this.inputNames)if(typeof a[g]>"u")throw new Error(`input '${g}' is missing in 'feeds'.`);if(d)for(let g of this.outputNames)u[g]=null;let p=await this.handler.run(a,u,c),m={};for(let g in p)if(Object.hasOwnProperty.call(p,g)){let v=p[g];v instanceof Ae?m[g]=v:m[g]=new Ae(v.type,v.data,v.dims)}return ot("InferenceSession.run"),vt(),m}async release(){return this.handler.dispose()}static async create(a,s,n,u){wt(),at("InferenceSession.create");let c,d={};if(typeof a=="string"){if(c=a,typeof s=="object"&&s!==null)d=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof Uint8Array){if(c=a,typeof s=="object"&&s!==null)d=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else if(a instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&a instanceof SharedArrayBuffer){let v=a,C=0,T=a.byteLength;if(typeof s=="object"&&s!==null)d=s;else if(typeof s=="number"){if(C=s,!Number.isSafeInteger(C))throw new RangeError("'byteOffset' must be an integer.");if(C<0||C>=v.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${v.byteLength}).`);if(T=a.byteLength-C,typeof n=="number"){if(T=n,!Number.isSafeInteger(T))throw new RangeError("'byteLength' must be an integer.");if(T<=0||C+T>v.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${v.byteLength-C}].`);if(typeof u=="object"&&u!==null)d=u;else if(typeof u<"u")throw new TypeError("'options' must be an object.")}else if(typeof n<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof s<"u")throw new TypeError("'options' must be an object.");c=new Uint8Array(v,C,T)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[p,m]=await $a(d),g=await p.createInferenceSessionHandler(c,m);return ot("InferenceSession.create"),vt(),new Qa(g)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),bn,Ql=W(()=>{Kl(),bn=Ka}),eu=W(()=>{}),tu=W(()=>{}),ru=W(()=>{}),nu=W(()=>{}),iu={};jt(iu,{InferenceSession:()=>bn,TRACE:()=>cn,TRACE_EVENT_BEGIN:()=>at,TRACE_EVENT_END:()=>ot,TRACE_FUNC_BEGIN:()=>wt,TRACE_FUNC_END:()=>vt,Tensor:()=>Ae,env:()=>ee,registerBackend:()=>yt});var st=W(()=>{zl(),ql(),Ql(),Ya(),eu(),tu(),Ja(),ru(),nu()}),Cn=W(()=>{}),eo={};jt(eo,{default:()=>to});var Fr,Vr,to,au=W(()=>{go(),lt(),Tn(),Fr="ort-wasm-proxy-worker",Vr=globalThis.self?.name===Fr,Vr&&(self.onmessage=r=>{let{type:a,in:s}=r.data;try{switch(a){case"init-wasm":_n(s.wasm).then(()=>{An(s).then(()=>{postMessage({type:a})},n=>{postMessage({type:a,err:n})})},n=>{postMessage({type:a,err:n})});break;case"init-ep":{let{epName:n,env:u}=s;Rn(u,n).then(()=>{postMessage({type:a})},c=>{postMessage({type:a,err:c})});break}case"copy-from":{let{buffer:n}=s,u=lr(n);postMessage({type:a,out:u});break}case"create":{let{model:n,options:u}=s;Sn(n,u).then(c=>{postMessage({type:a,out:c})},c=>{postMessage({type:a,err:c})});break}case"release":Pn(s),postMessage({type:a});break;case"run":{let{sessionId:n,inputIndices:u,inputs:c,outputIndices:d,options:p}=s;Mn(n,u,c,d,new Array(d.length).fill(null),p).then(m=>{m.some(g=>g[3]!=="cpu")?postMessage({type:a,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:a,out:m},Bn([...c,...m]))},m=>{postMessage({type:a,err:m})});break}case"end-profiling":Un(s),postMessage({type:a});break;default:}}catch(n){postMessage({type:a,err:n})}}),to=Vr?null:r=>new Worker(r??ve,{type:"module",name:Fr})}),ro={};jt(ro,{default:()=>no});var zr,no,la,ou=W(()=>{zr=async function(r={}){var a,s,n=r,u=new Promise((e,t)=>{a=e,s=t}),c=typeof window=="object",d=typeof WorkerGlobalScope<"u",p=d&&self.name?.startsWith("em-pthread");n.mountExternalData=(e,t)=>{e.startsWith("./")&&(e=e.substring(2)),(n.fc||(n.fc=new Map)).set(e,t)},n.unmountExternalData=()=>{delete n.fc};var m=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,ld:!0}).buffer.constructor;let g=()=>{let e=(t,i,o)=>(...l)=>{let f=Be,h=i?.();l=t(...l);let y=i?.();return h!==y&&(t=y,o(h),i=o=null),Be!=f?new Promise((b,_)=>{_r={resolve:b,reject:_}}):l};(()=>{for(let t of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])n[t]=e(n[t],()=>n[t],i=>n[t]=i)})(),typeof jsepRunAsync<"u"&&(n._OrtRun=jsepRunAsync(n._OrtRun),n._OrtRunWithBinding=jsepRunAsync(n._OrtRunWithBinding)),g=void 0};n.asyncInit=()=>{g?.()};var v,C,T=(e,t)=>{throw t},I=import.meta.url,O="";if(c||d){try{O=new URL(".",I).href}catch{}d&&(C=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),v=async e=>{if(X(e))return new Promise((i,o)=>{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onload=()=>{l.status==200||l.status==0&&l.response?i(l.response):o(l.status)},l.onerror=o,l.send(null)});var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw Error(t.status+" : "+t.url)}}var $,S,A,P,D,L,N,te,le,Y,ie,re,J,V,ye,j=console.log.bind(console),ne=console.error.bind(console),$e=j,k=ne,ue=!1,X=e=>e.startsWith("file://");function K(){return S.buffer!=D.buffer&&G(),D}function ae(){return S.buffer!=D.buffer&&G(),L}function Re(){return S.buffer!=D.buffer&&G(),N}function ut(){return S.buffer!=D.buffer&&G(),te}function M(){return S.buffer!=D.buffer&&G(),le}function E(){return S.buffer!=D.buffer&&G(),Y}function Te(){return S.buffer!=D.buffer&&G(),ie}function ge(){return S.buffer!=D.buffer&&G(),V}if(p){let e=function(t){try{var i=t.data,o=i.dc;if(o==="load"){let l=[];self.onmessage=f=>l.push(f),self.startWorker=()=>{postMessage({dc:"loaded"});for(let f of l)e(f);self.onmessage=e};for(let f of i.Uc)n[f]&&!n[f].proxy||(n[f]=(...h)=>{postMessage({dc:"callHandler",Tc:f,args:h})},f=="print"&&($e=n[f]),f=="printErr"&&(k=n[f]));S=i.bd,G(),ye(i.cd)}else if(o==="run"){So(i.ac),$r(i.ac,0,0,1,0,0),Gn(),Cr(i.ac),oe||($i(),oe=!0);try{Po(i.Zc,i.jc)}catch(l){if(l!="unwind")throw l}}else i.target!=="setimmediate"&&(o==="checkMailbox"?oe&&Dt():o&&(k(`worker: received unknown command ${o}`),k(i)))}catch(l){throw Yi(),l}};var oe=!1;self.onunhandledrejection=t=>{throw t.reason||t},self.onmessage=e}function G(){var e=S.buffer;n.HEAP8=D=new Int8Array(e),N=new Int16Array(e),n.HEAPU8=L=new Uint8Array(e),te=new Uint16Array(e),n.HEAP32=le=new Int32Array(e),n.HEAPU32=Y=new Uint32Array(e),ie=new Float32Array(e),V=new Float64Array(e),re=new BigInt64Array(e),J=new BigUint64Array(e)}function _e(){p?startWorker(n):w.nb()}var Ke,je=0,Ct=null;function Ln(){if(--je==0&&Ct){var e=Ct;Ct=null,e()}}function De(e){throw k(e="Aborted("+e+")"),ue=!0,e=new WebAssembly.RuntimeError(e+". Build with -sASSERTIONS for more info."),s(e),e}function $n(){return{a:{R:Dl,b:Uo,ba:Hn,I:Xn,ra:Yn,jb:Jn,lb:Kn,sa:Qn,pa:ei,ia:ti,oa:ri,P:ni,kb:ii,hb:ai,qa:oi,ib:si,xa:Bo,Z:Lo,cb:$o,ab:Do,Y:No,w:Wo,t:Go,bb:Fo,L:Yo,db:Jo,la:Ko,fb:Qo,ca:es,_a:ts,$:rs,ka:Cr,ua:ns,s:is,Na:as,A:ls,o:us,m:cs,c:wr,Ma:ds,n:ps,i:ys,v:gs,p:ws,f:vs,u:bs,k:Cs,e:Ts,j:_s,h:xs,g:Es,d:Is,fa:Os,ga:As,ha:Rs,da:bi,ea:Ci,$a:Ti,za:Ps,wa:Us,E:Bs,La:Ls,M:$s,va:Ms,C:js,ta:Ds,gb:ks,r:Ss,Ia:Ns,F:Ws,Q:Gs,eb:Fs,Ba:Vs,Aa:zs,Ha:Ks,q:Qs,U:el,T:tl,Ka:rl,D:nl,l:il,Ga:al,Fa:ol,Ja:sl,Ea:ll,Da:ul,Ca:fl,ma:Ai,na:Ri,aa:hr,J:Si,O:Pi,ja:Mi,N:Ui,a:S,ya:pr,Xa:dl,K:pl,x:hl,S:ml,Ya:yl,y:gl,Ta:wl,Va:vl,V:bl,z:Cl,_:Tl,W:_l,G:xl,Ra:El,mb:Il,B:Ol,Ua:Al,Wa:Rl,Oa:Sl,Pa:Pl,Qa:Ml,H:Ul,X:Bl,Sa:Ll,Za:$l}}}class cr{name="ExitStatus";constructor(t){this.message=`Program terminated with exit(${t})`,this.status=t}}var jn=e=>{e.terminate(),e.onmessage=()=>{}},dr=[],Dn=e=>{ze.length==0&&(Vn(),Fn(ze[0]));var t=ze.pop();if(!t)return 6;Tt.push(t),Qe[e.ac]=t,t.ac=e.ac;var i={dc:"run",Zc:e.Yc,jc:e.jc,ac:e.ac};return t.postMessage(i,e.Oc),0},se=0,Q=(e,t,...i)=>{for(var o=2*i.length,l=Ie(),f=Zt(8*o),h=f>>>3,y=0;y<i.length;y++){var b=i[y];typeof b=="bigint"?(re[h+2*y]=1n,re[h+2*y+1]=b):(re[h+2*y]=0n,ge()[h+2*y+1>>>0]=b)}return e=Ji(e,0,o,f,t),Ee(l),e};function pr(e){if(p)return Q(0,1,e);if(P=e,!(0<se)){for(var t of Tt)jn(t);for(t of ze)jn(t);ze=[],Tt=[],Qe={},ue=!0}T(0,new cr(e))}function kn(e){if(p)return Q(1,0,e);hr(e)}var hr=e=>{if(P=e,p)throw kn(e),"unwind";pr(e)},ze=[],Tt=[],Nn=[],Qe={},Wn=e=>{var t=e.ac;delete Qe[t],ze.push(e),Tt.splice(Tt.indexOf(e),1),e.ac=0,Ki(t)};function Gn(){Nn.forEach(e=>e())}var Fn=e=>new Promise(t=>{e.onmessage=l=>{var f=(l=l.data).dc;if(l.hc&&l.hc!=Pr()){var h=Qe[l.hc];h?h.postMessage(l,l.Oc):k(`Internal error! Worker sent a message "${f}" to target pthread ${l.hc}, but that thread no longer exists!`)}else f==="checkMailbox"?Dt():f==="spawnThread"?Dn(l):f==="cleanupThread"?Wn(Qe[l.$c]):f==="loaded"?(e.loaded=!0,t(e)):l.target==="setimmediate"?e.postMessage(l):f==="callHandler"?n[l.Tc](...l.args):f&&k(`worker sent an unknown command ${f}`)},e.onerror=l=>{throw k(`worker sent an error! ${l.filename}:${l.lineno}: ${l.message}`),l};var i,o=[];for(i of[])n.propertyIsEnumerable(i)&&o.push(i);e.postMessage({dc:"load",Uc:o,bd:S,cd:A})});function Vn(){var e=new Worker((()=>{let t=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new t("ort.webgpu.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});ze.push(e)}var So=e=>{G();var t=E()[e+52>>>2>>>0];e=E()[e+56>>>2>>>0],ta(t,t-e),Ee(t)},Po=(e,t)=>{se=0,e=ra(e,t),0<se?P=e:jr(e)};class Mo{constructor(t){this.ic=t-24}}var we=e=>-9007199254740992>e||9007199254740992<e?NaN:Number(e);function Uo(e,t,i){var o=new Mo(e>>>=0);throw t>>>=0,i>>>=0,E()[o.ic+16>>>2>>>0]=0,E()[o.ic+4>>>2>>>0]=t,E()[o.ic+8>>>2>>>0]=i,e}function zn(e,t,i,o){return p?Q(2,1,e,t,i,o):Hn(e,t,i,o)}function Hn(e,t,i,o){if(e>>>=0,i>>>=0,o>>>=0,m===void 0)return 6;var l=[];return p&&l.length===0?zn(e,t>>>=0,i,o):(e={Yc:i,ac:e,jc:o,Oc:l},p?(e.dc="spawnThread",postMessage(e,l),0):Dn(e))}var qn=typeof TextDecoder<"u"?new TextDecoder:void 0,Zn=(e,t=0,i=NaN)=>{var o=(t>>>=0)+i;for(i=t;e[i]&&!(i>=o);)++i;if(16<i-t&&e.buffer&&qn)return qn.decode(e.buffer instanceof ArrayBuffer?e.subarray(t,i):e.slice(t,i));for(o="";t<i;){var l=e[t++];if(128&l){var f=63&e[t++];if((224&l)==192)o+=String.fromCharCode((31&l)<<6|f);else{var h=63&e[t++];65536>(l=(240&l)==224?(15&l)<<12|f<<6|h:(7&l)<<18|f<<12|h<<6|63&e[t++])?o+=String.fromCharCode(l):(l-=65536,o+=String.fromCharCode(55296|l>>10,56320|1023&l))}}else o+=String.fromCharCode(l)}return o},ft=(e,t)=>(e>>>=0)?Zn(ae(),e,t):"";function Xn(e,t,i){return p?Q(3,1,e,t,i):0}function Yn(e,t){if(p)return Q(4,1,e,t)}function Jn(e,t){if(p)return Q(5,1,e,t)}function Kn(e,t,i){if(p)return Q(6,1,e,t,i)}function Qn(e,t,i){return p?Q(7,1,e,t,i):0}function ei(e,t){if(p)return Q(8,1,e,t)}function ti(e,t,i){if(p)return Q(9,1,e,t,i)}function ri(e,t,i,o){if(p)return Q(10,1,e,t,i,o)}function ni(e,t,i,o){if(p)return Q(11,1,e,t,i,o)}function ii(e,t,i,o){if(p)return Q(12,1,e,t,i,o)}function ai(e){if(p)return Q(13,1,e)}function oi(e,t){if(p)return Q(14,1,e,t)}function si(e,t,i){if(p)return Q(15,1,e,t,i)}var li,Bo=()=>De(""),Ue=e=>{for(var t="";ae()[e>>>0];)t+=li[ae()[e++>>>0]];return t},mr={},yr={},ct=n.BindingError=class extends Error{constructor(e){super(e),this.name="BindingError"}};function ke(e,t,i={}){return(function(o,l,f={}){var h=l.name;if(!o)throw new ct(`type "${h}" must have a positive integer typeid pointer`);if(yr.hasOwnProperty(o)){if(f.Vc)return;throw new ct(`Cannot register type '${h}' twice`)}yr[o]=l,mr.hasOwnProperty(o)&&(l=mr[o],delete mr[o],l.forEach(y=>y()))})(e,t,i)}var ui=(e,t,i)=>{switch(t){case 1:return i?o=>K()[o>>>0]:o=>ae()[o>>>0];case 2:return i?o=>Re()[o>>>1>>>0]:o=>ut()[o>>>1>>>0];case 4:return i?o=>M()[o>>>2>>>0]:o=>E()[o>>>2>>>0];case 8:return i?o=>re[o>>>3]:o=>J[o>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function Lo(e,t,i){i>>>=0,ke(e>>>=0,{name:t=Ue(t>>>0),fromWireType:o=>o,toWireType:function(o,l){if(typeof l!="bigint"&&typeof l!="number")throw l=l===null?"null":(o=typeof l)=="object"||o==="array"||o==="function"?l.toString():""+l,new TypeError(`Cannot convert "${l}" to ${this.name}`);return typeof l=="number"&&(l=BigInt(l)),l},cc:He,readValueFromPointer:ui(t,i,t.indexOf("u")==-1),ec:null})}var He=8;function $o(e,t,i,o){ke(e>>>=0,{name:t=Ue(t>>>0),fromWireType:function(l){return!!l},toWireType:function(l,f){return f?i:o},cc:He,readValueFromPointer:function(l){return this.fromWireType(ae()[l>>>0])},ec:null})}var gr=[],Ne=[];function wr(e){9<(e>>>=0)&&--Ne[e+1]==0&&(Ne[e]=void 0,gr.push(e))}var de=e=>{if(!e)throw new ct(`Cannot use deleted val. handle = ${e}`);return Ne[e]},xe=e=>{switch(e){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let t=gr.pop()||Ne.length;return Ne[t]=e,Ne[t+1]=1,t}};function vr(e){return this.fromWireType(E()[e>>>2>>>0])}var jo={name:"emscripten::val",fromWireType:e=>{var t=de(e);return wr(e),t},toWireType:(e,t)=>xe(t),cc:He,readValueFromPointer:vr,ec:null};function Do(e){return ke(e>>>0,jo)}var ko=(e,t)=>{switch(t){case 4:return function(i){return this.fromWireType(Te()[i>>>2>>>0])};case 8:return function(i){return this.fromWireType(ge()[i>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}};function No(e,t,i){i>>>=0,ke(e>>>=0,{name:t=Ue(t>>>0),fromWireType:o=>o,toWireType:(o,l)=>l,cc:He,readValueFromPointer:ko(t,i),ec:null})}function Wo(e,t,i,o,l){if(e>>>=0,i>>>=0,t=Ue(t>>>0),l===-1&&(l=4294967295),l=y=>y,o===0){var f=32-8*i;l=y=>y<<f>>>f}var h=t.includes("unsigned")?function(y,b){return b>>>0}:function(y,b){return b};ke(e,{name:t,fromWireType:l,toWireType:h,cc:He,readValueFromPointer:ui(t,i,o!==0),ec:null})}function Go(e,t,i){function o(f){var h=E()[f>>>2>>>0];return f=E()[f+4>>>2>>>0],new l(K().buffer,f,h)}var l=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][t];ke(e>>>=0,{name:i=Ue(i>>>0),fromWireType:o,cc:He,readValueFromPointer:o},{Vc:!0})}var We=(e,t,i)=>{var o=ae();if(t>>>=0,0<i){var l=t;i=t+i-1;for(var f=0;f<e.length;++f){var h=e.charCodeAt(f);if(55296<=h&&57343>=h&&(h=65536+((1023&h)<<10)|1023&e.charCodeAt(++f)),127>=h){if(t>=i)break;o[t++>>>0]=h}else{if(2047>=h){if(t+1>=i)break;o[t++>>>0]=192|h>>6}else{if(65535>=h){if(t+2>=i)break;o[t++>>>0]=224|h>>12}else{if(t+3>=i)break;o[t++>>>0]=240|h>>18,o[t++>>>0]=128|h>>12&63}o[t++>>>0]=128|h>>6&63}o[t++>>>0]=128|63&h}}o[t>>>0]=0,e=t-l}else e=0;return e},Ge=e=>{for(var t=0,i=0;i<e.length;++i){var o=e.charCodeAt(i);127>=o?t++:2047>=o?t+=2:55296<=o&&57343>=o?(t+=4,++i):t+=3}return t};function Fo(e,t){ke(e>>>=0,{name:t=Ue(t>>>0),fromWireType:function(i){for(var o,l=E()[i>>>2>>>0],f=i+4,h=f,y=0;y<=l;++y){var b=f+y;y!=l&&ae()[b>>>0]!=0||(h=ft(h,b-h),o===void 0?o=h:(o+="\0",o+=h),h=b+1)}return Se(i),o},toWireType:function(i,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var l=typeof o=="string";if(!(l||ArrayBuffer.isView(o)&&o.BYTES_PER_ELEMENT==1))throw new ct("Cannot pass non-string to std::string");var f=l?Ge(o):o.length,h=pt(4+f+1),y=h+4;return E()[h>>>2>>>0]=f,l?We(o,y,f+1):ae().set(o,y>>>0),i!==null&&i.push(Se,h),h},cc:He,readValueFromPointer:vr,ec(i){Se(i)}})}var fi=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Vo=(e,t)=>{for(var i=e>>1,o=i+t/2;!(i>=o)&&ut()[i>>>0];)++i;if(32<(i<<=1)-e&&fi)return fi.decode(ae().slice(e,i));for(i="",o=0;!(o>=t/2);++o){var l=Re()[e+2*o>>>1>>>0];if(l==0)break;i+=String.fromCharCode(l)}return i},zo=(e,t,i)=>{if(i??=2147483647,2>i)return 0;var o=t;i=(i-=2)<2*e.length?i/2:e.length;for(var l=0;l<i;++l){var f=e.charCodeAt(l);Re()[t>>>1>>>0]=f,t+=2}return Re()[t>>>1>>>0]=0,t-o},Ho=e=>2*e.length,qo=(e,t)=>{for(var i=0,o="";!(i>=t/4);){var l=M()[e+4*i>>>2>>>0];if(l==0)break;++i,65536<=l?(l-=65536,o+=String.fromCharCode(55296|l>>10,56320|1023&l)):o+=String.fromCharCode(l)}return o},Zo=(e,t,i)=>{if(t>>>=0,i??=2147483647,4>i)return 0;var o=t;i=o+i-4;for(var l=0;l<e.length;++l){var f=e.charCodeAt(l);if(55296<=f&&57343>=f&&(f=65536+((1023&f)<<10)|1023&e.charCodeAt(++l)),M()[t>>>2>>>0]=f,(t+=4)+4>i)break}return M()[t>>>2>>>0]=0,t-o},Xo=e=>{for(var t=0,i=0;i<e.length;++i){var o=e.charCodeAt(i);55296<=o&&57343>=o&&++i,t+=4}return t};function Yo(e,t,i){if(e>>>=0,t>>>=0,i=Ue(i>>>=0),t===2)var o=Vo,l=zo,f=Ho,h=y=>ut()[y>>>1>>>0];else t===4&&(o=qo,l=Zo,f=Xo,h=y=>E()[y>>>2>>>0]);ke(e,{name:i,fromWireType:y=>{for(var b,_=E()[y>>>2>>>0],R=y+4,x=0;x<=_;++x){var B=y+4+x*t;x!=_&&h(B)!=0||(R=o(R,B-R),b===void 0?b=R:(b+="\0",b+=R),R=B+t)}return Se(y),b},toWireType:(y,b)=>{if(typeof b!="string")throw new ct(`Cannot pass non-string to C++ string type ${i}`);var _=f(b),R=pt(4+_+t);return E()[R>>>2>>>0]=_/t,l(b,R+4,_+t),y!==null&&y.push(Se,R),R},cc:He,readValueFromPointer:vr,ec(y){Se(y)}})}function Jo(e,t){ke(e>>>=0,{Wc:!0,name:t=Ue(t>>>0),cc:0,fromWireType:()=>{},toWireType:()=>{}})}function Ko(e){$r(e>>>0,!d,1,!c,131072,!1),Gn()}var br=e=>{if(!ue)try{if(e(),!(0<se))try{p?jr(P):hr(P)}catch(t){t instanceof cr||t=="unwind"||T(0,t)}}catch(t){t instanceof cr||t=="unwind"||T(0,t)}};function Cr(e){e>>>=0,typeof Atomics.ad=="function"&&(Atomics.ad(M(),e>>>2,e).value.then(Dt),e+=128,Atomics.store(M(),e>>>2,1))}var Dt=()=>{var e=Pr();e&&(Cr(e),br(ea))};function Qo(e,t){(e>>>=0)==t>>>0?setTimeout(Dt):p?postMessage({hc:e,dc:"checkMailbox"}):(e=Qe[e])&&e.postMessage({dc:"checkMailbox"})}var Tr=[];function es(e,t,i,o,l){for(t>>>=0,o/=2,Tr.length=o,i=l>>>0>>>3,l=0;l<o;l++)Tr[l]=re[i+2*l]?re[i+2*l+1]:ge()[i+2*l+1>>>0];return(t?Rr[t]:jl[e])(...Tr)}var ts=()=>{se=0};function rs(e){e>>>=0,p?postMessage({dc:"cleanupThread",$c:e}):Wn(Qe[e])}function ns(e){}var kt=(e,t)=>{var i=yr[e];if(i===void 0)throw e=Li(e),i=Ue(e),Se(e),new ct(`${t} has unknown type ${i}`);return i},ci=(e,t,i)=>{var o=[];return e=e.toWireType(o,i),o.length&&(E()[t>>>2>>>0]=xe(o)),e};function is(e,t,i){return t>>>=0,i>>>=0,e=de(e>>>0),t=kt(t,"emval::as"),ci(t,i,e)}function as(e,t){return t>>>=0,e=de(e>>>0),(t=kt(t,"emval::as")).toWireType(null,e)}var Nt=e=>{try{e()}catch(t){De(t)}},qe=0,Be=null,di=0,Wt=[],pi={},hi={},os=0,_r=null,ss=[];function mi(e){return(function(t){if(!ue){if(qe===0){var i=!1,o=!1;t((l=0)=>{if(!ue&&(di=l,i=!0,o)){qe=2,Nt(()=>aa(Be)),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.resume(),l=!1;try{var f=(function(){var b=M()[Be+8>>>2>>>0];return b=w[hi[b]],--se,b()})()}catch(b){f=b,l=!0}var h=!1;if(!Be){var y=_r;y&&(_r=null,(l?y.reject:y.resolve)(f),h=!0)}if(l&&!h)throw f}}),o=!0,i||(qe=1,Be=(function(){var l=pt(65548),f=l+12;E()[l>>>2>>>0]=f,E()[l+4>>>2>>>0]=f+65536,f=Wt[0];var h=pi[f];return h===void 0&&(h=os++,pi[f]=h,hi[h]=f),f=h,M()[l+8>>>2>>>0]=f,l})(),typeof MainLoop<"u"&&MainLoop.Sc&&MainLoop.pause(),Nt(()=>na(Be)))}else qe===2?(qe=0,Nt(oa),Se(Be),Be=null,ss.forEach(br)):De(`invalid state: ${qe}`);return di}})(t=>{e().then(t)})}function ls(e){return e>>>=0,mi(async()=>{var t=await de(e);return xe(t)})}var Gt=[];function us(e,t,i,o){return i>>>=0,o>>>=0,(e=Gt[e>>>0])(null,t=de(t>>>0),i,o)}var fs={},Ft=e=>{var t=fs[e];return t===void 0?Ue(e):t};function cs(e,t,i,o,l){return i>>>=0,o>>>=0,l>>>=0,(e=Gt[e>>>0])(t=de(t>>>0),t[i=Ft(i)],o,l)}function ds(e,t){return t>>>=0,(e=de(e>>>0))==de(t)}var yi=()=>typeof globalThis=="object"?globalThis:Function("return this")();function ps(e){return(e>>>=0)==0?xe(yi()):(e=Ft(e),xe(yi()[e]))}var hs=e=>{var t=Gt.length;return Gt.push(e),t},ms=(e,t)=>{for(var i=Array(e),o=0;o<e;++o)i[o]=kt(E()[t+4*o>>>2>>>0],`parameter ${o}`);return i};function ys(e,t,i){var o=(t=ms(e,t>>>0)).shift();e--;var l=`return function (obj, func, destructorsRef, args) {
`,f=0,h=[];i===0&&h.push("obj");for(var y=["retType"],b=[o],_=0;_<e;++_)h.push(`arg${_}`),y.push(`argType${_}`),b.push(t[_]),l+=`  var arg${_} = argType${_}.readValueFromPointer(args${f?"+"+f:""});
`,f+=t[_].cc;return l+=`  var rv = ${i===1?"new func":"func.call"}(${h.join(", ")});
`,o.Wc||(y.push("emval_returnValue"),b.push(ci),l+=`  return emval_returnValue(retType, destructorsRef, rv);
`),e=new Function(...y,l+`};
`)(...b),i=`methodCaller<(${t.map(R=>R.name).join(", ")}) => ${o.name}>`,hs(Object.defineProperty(e,"name",{value:i}))}function gs(e){return e=Ft(e>>>0),xe(n[e])}function ws(e,t){return t>>>=0,e=de(e>>>0),t=de(t),xe(e[t])}function vs(e){9<(e>>>=0)&&(Ne[e+1]+=1)}function bs(){return xe([])}function Cs(e){e=de(e>>>0);for(var t=Array(e.length),i=0;i<e.length;i++)t[i]=e[i];return xe(t)}function Ts(e){return xe(Ft(e>>>0))}function _s(){return xe({})}function xs(e){for(var t=de(e>>>=0);t.length;){var i=t.pop();t.pop()(i)}wr(e)}function Es(e,t,i){t>>>=0,i>>>=0,e=de(e>>>0),t=de(t),i=de(i),e[t]=i}function Is(e,t){return t>>>=0,e=(e=kt(e>>>0,"_emval_take_value")).readValueFromPointer(t),xe(e)}function Os(e,t){e=we(e),t>>>=0,e=new Date(1e3*e),M()[t>>>2>>>0]=e.getUTCSeconds(),M()[t+4>>>2>>>0]=e.getUTCMinutes(),M()[t+8>>>2>>>0]=e.getUTCHours(),M()[t+12>>>2>>>0]=e.getUTCDate(),M()[t+16>>>2>>>0]=e.getUTCMonth(),M()[t+20>>>2>>>0]=e.getUTCFullYear()-1900,M()[t+24>>>2>>>0]=e.getUTCDay(),e=(e.getTime()-Date.UTC(e.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,M()[t+28>>>2>>>0]=e}var gi=e=>e%4==0&&(e%100!=0||e%400==0),wi=[0,31,60,91,121,152,182,213,244,274,305,335],vi=[0,31,59,90,120,151,181,212,243,273,304,334];function As(e,t){e=we(e),t>>>=0,e=new Date(1e3*e),M()[t>>>2>>>0]=e.getSeconds(),M()[t+4>>>2>>>0]=e.getMinutes(),M()[t+8>>>2>>>0]=e.getHours(),M()[t+12>>>2>>>0]=e.getDate(),M()[t+16>>>2>>>0]=e.getMonth(),M()[t+20>>>2>>>0]=e.getFullYear()-1900,M()[t+24>>>2>>>0]=e.getDay();var i=(gi(e.getFullYear())?wi:vi)[e.getMonth()]+e.getDate()-1|0;M()[t+28>>>2>>>0]=i,M()[t+36>>>2>>>0]=-60*e.getTimezoneOffset(),i=new Date(e.getFullYear(),6,1).getTimezoneOffset();var o=new Date(e.getFullYear(),0,1).getTimezoneOffset();e=0|(i!=o&&e.getTimezoneOffset()==Math.min(o,i)),M()[t+32>>>2>>>0]=e}function Rs(e){e>>>=0;var t=new Date(M()[e+20>>>2>>>0]+1900,M()[e+16>>>2>>>0],M()[e+12>>>2>>>0],M()[e+8>>>2>>>0],M()[e+4>>>2>>>0],M()[e>>>2>>>0],0),i=M()[e+32>>>2>>>0],o=t.getTimezoneOffset(),l=new Date(t.getFullYear(),6,1).getTimezoneOffset(),f=new Date(t.getFullYear(),0,1).getTimezoneOffset(),h=Math.min(f,l);return 0>i?M()[e+32>>>2>>>0]=+(l!=f&&h==o):0<i!=(h==o)&&(l=Math.max(f,l),t.setTime(t.getTime()+6e4*((0<i?h:l)-o))),M()[e+24>>>2>>>0]=t.getDay(),i=(gi(t.getFullYear())?wi:vi)[t.getMonth()]+t.getDate()-1|0,M()[e+28>>>2>>>0]=i,M()[e>>>2>>>0]=t.getSeconds(),M()[e+4>>>2>>>0]=t.getMinutes(),M()[e+8>>>2>>>0]=t.getHours(),M()[e+12>>>2>>>0]=t.getDate(),M()[e+16>>>2>>>0]=t.getMonth(),M()[e+20>>>2>>>0]=t.getYear(),e=t.getTime(),BigInt(isNaN(e)?-1:e/1e3)}function bi(e,t,i,o,l,f,h){return p?Q(16,1,e,t,i,o,l,f,h):-52}function Ci(e,t,i,o,l,f){if(p)return Q(17,1,e,t,i,o,l,f)}var _t={},Ss=()=>performance.timeOrigin+performance.now();function Ti(e,t){if(p)return Q(18,1,e,t);if(_t[e]&&(clearTimeout(_t[e].id),delete _t[e]),!t)return 0;var i=setTimeout(()=>{delete _t[e],br(()=>Qi(e,performance.timeOrigin+performance.now()))},t);return _t[e]={id:i,nd:t},0}function Ps(e,t,i,o){e>>>=0,t>>>=0,i>>>=0,o>>>=0;var l=new Date().getFullYear(),f=new Date(l,0,1).getTimezoneOffset();l=new Date(l,6,1).getTimezoneOffset();var h=Math.max(f,l);E()[e>>>2>>>0]=60*h,M()[t>>>2>>>0]=+(f!=l),e=(t=y=>{var b=Math.abs(y);return`UTC${0<=y?"-":"+"}${String(Math.floor(b/60)).padStart(2,"0")}${String(b%60).padStart(2,"0")}`})(f),t=t(l),l<f?(We(e,i,17),We(t,o,17)):(We(e,o,17),We(t,i,17))}var Ms=()=>Date.now();function Us(e,t,i){return 0<=e&&3>=e?(e===0?e=Date.now():e=performance.timeOrigin+performance.now(),re[i>>>0>>>3]=BigInt(Math.round(1e6*e)),0):28}var xr=[],_i=(e,t)=>{xr.length=0;for(var i;i=ae()[e++>>>0];){var o=i!=105;t+=(o&=i!=112)&&t%8?4:0,xr.push(i==112?E()[t>>>2>>>0]:i==106?re[t>>>3]:i==105?M()[t>>>2>>>0]:ge()[t>>>3>>>0]),t+=o?8:4}return xr};function Bs(e,t,i){return e>>>=0,t=_i(t>>>0,i>>>0),Rr[e](...t)}function Ls(e,t,i){return e>>>=0,t=_i(t>>>0,i>>>0),Rr[e](...t)}var $s=()=>{};function js(e,t){return k(ft(e>>>0,t>>>0))}var Ds=()=>{throw se+=1,"unwind"};function ks(){return 4294901760}var Ns=()=>1,Ws=()=>navigator.hardwareConcurrency;function Gs(){return De("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function Fs(e){e>>>=0;var t=ae().length;if(e<=t||4294901760<e)return!1;for(var i=1;4>=i;i*=2){var o=t*(1+.2/i);o=Math.min(o,e+100663296);e:{o=(Math.min(4294901760,65536*Math.ceil(Math.max(e,o)/65536))-S.buffer.byteLength+65535)/65536|0;try{S.grow(o),G();var l=1;break e}catch{}l=void 0}if(l)return!0}return!1}var Vt=()=>(De("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),xt={},xi=e=>{e.forEach(t=>{Vt()})};function Vs(){var e=Error().stack.toString().split(`
`);return e[0]=="Error"&&e.shift(),xi(e),xt.oc=Vt(),xt.Xc=e,xt.oc}function zs(e,t,i){if(e>>>=0,t>>>=0,xt.oc==e)var o=xt.Xc;else(o=Error().stack.toString().split(`
`))[0]=="Error"&&o.shift(),xi(o);for(var l=3;o[l]&&Vt()!=e;)++l;for(e=0;e<i&&o[e+l];++e)M()[t+4*e>>>2>>>0]=Vt();return e}var Fe=e=>{var t=Ge(e)+1,i=Zt(t);return We(e,i,t),i},Er=[],pe=(e,t)=>{Er[e>>>=0]=t},Le=[],zt=[],Et=(e,t)=>{zt[e]=new Promise(i=>t.finally(()=>i(e)))},U=e=>{if(e)return Er[e>>>0]},Ht=(e,t,i)=>{E()[e>>>2>>>0]=t,E()[e+4>>>2>>>0]=i},Ei=e=>{var t=E()[e>>>2>>>0];return e=E()[e+4>>>2>>>0],ft(t,e)},Ve=e=>{var t=E()[e>>>2>>>0];return e=E()[e+4>>>2>>>0],t?ft(t,e):e===0?"":void 0},Ii=(e,t)=>{function i(l,f){l=e[l],M()[t+f>>>2>>>0]=l}function o(l,f){re[t+f>>>3]=BigInt(e[l])}i("maxTextureDimension1D",4),i("maxTextureDimension2D",8),i("maxTextureDimension3D",12),i("maxTextureArrayLayers",16),i("maxBindGroups",20),i("maxBindGroupsPlusVertexBuffers",24),i("maxBindingsPerBindGroup",28),i("maxDynamicUniformBuffersPerPipelineLayout",32),i("maxDynamicStorageBuffersPerPipelineLayout",36),i("maxSampledTexturesPerShaderStage",40),i("maxSamplersPerShaderStage",44),i("maxStorageBuffersPerShaderStage",48),i("maxStorageTexturesPerShaderStage",52),i("maxUniformBuffersPerShaderStage",56),i("minUniformBufferOffsetAlignment",80),i("minStorageBufferOffsetAlignment",84),o("maxUniformBufferBindingSize",64),o("maxStorageBufferBindingSize",72),i("maxVertexBuffers",88),o("maxBufferSize",96),i("maxVertexAttributes",104),i("maxVertexBufferArrayStride",108),i("maxInterStageShaderVariables",112),i("maxColorAttachments",116),i("maxColorAttachmentBytesPerSample",120),i("maxComputeWorkgroupStorageSize",124),i("maxComputeInvocationsPerWorkgroup",128),i("maxComputeWorkgroupSizeX",132),i("maxComputeWorkgroupSizeY",136),i("maxComputeWorkgroupSizeZ",140),i("maxComputeWorkgroupsPerDimension",144),e.kd!==void 0&&i("maxImmediateSize",148)},Hs={undefined:1,pd:1,gd:2},qs={1:"validation",2:"out-of-memory",3:"internal"},Zs=[,"compatibility","core"],Ir={1:"depth-clip-control",2:"depth32float-stencil8",3:"timestamp-query",4:"texture-compression-bc",5:"texture-compression-bc-sliced-3d",6:"texture-compression-etc2",7:"texture-compression-astc",8:"texture-compression-astc-sliced-3d",9:"indirect-first-instance",10:"shader-f16",11:"rg11b10ufloat-renderable",12:"bgra8unorm-storage",13:"float32-filterable",14:"float32-blendable",15:"clip-distances",16:"dual-source-blending",17:"subgroups",18:"core-features-and-limits",327692:"chromium-experimental-unorm16-texture-formats",327693:"chromium-experimental-snorm16-texture-formats",327732:"chromium-experimental-multi-draw-indirect"},Xs=[,"low-power","high-performance"],Ys={1:"occlusion",2:"timestamp"},Js={"depth-clip-control":"1","depth32float-stencil8":"2","timestamp-query":"3","texture-compression-bc":"4","texture-compression-bc-sliced-3d":"5","texture-compression-etc2":"6","texture-compression-astc":"7","texture-compression-astc-sliced-3d":"8","indirect-first-instance":"9","shader-f16":"10","rg11b10ufloat-renderable":"11","bgra8unorm-storage":"12","float32-filterable":"13","float32-blendable":"14","clip-distances":"15","dual-source-blending":"16",md:"17","core-features-and-limits":"18","chromium-experimental-unorm16-texture-formats":"327692","chromium-experimental-snorm16-texture-formats":"327693","chromium-experimental-multi-draw-indirect":"327732"};function Ks(e,t,i,o,l,f){t=we(t),i=we(i),o>>>=0,l>>>=0,f>>>=0,e=U(e>>>0);var h={};if(f){var y=E()[f+12>>>2>>>0];if(y){var b=E()[f+16>>>2>>>0];h.requiredFeatures=Array.from(E().subarray(b>>>2>>>0,b+4*y>>>2>>>0),x=>Ir[x])}var _=E()[f+20>>>2>>>0];if(_){let x=function(F,z,he=!1){z=_+z,(z=E()[z>>>2>>>0])==4294967295||he&&z==0||(R[F]=z)},B=function(F,z){z=_+z;var he=E()[z>>>2>>>0],Pe=E()[z+4>>>2>>>0];he==4294967295&&Pe==4294967295||(R[F]=4294967296*E()[z+4>>>2>>>0]+E()[z>>>2>>>0])};var R={};x("maxTextureDimension1D",4),x("maxTextureDimension2D",8),x("maxTextureDimension3D",12),x("maxTextureArrayLayers",16),x("maxBindGroups",20),x("maxBindGroupsPlusVertexBuffers",24),x("maxDynamicUniformBuffersPerPipelineLayout",32),x("maxDynamicStorageBuffersPerPipelineLayout",36),x("maxSampledTexturesPerShaderStage",40),x("maxSamplersPerShaderStage",44),x("maxStorageBuffersPerShaderStage",48),x("maxStorageTexturesPerShaderStage",52),x("maxUniformBuffersPerShaderStage",56),x("minUniformBufferOffsetAlignment",80),x("minStorageBufferOffsetAlignment",84),B("maxUniformBufferBindingSize",64),B("maxStorageBufferBindingSize",72),x("maxVertexBuffers",88),B("maxBufferSize",96),x("maxVertexAttributes",104),x("maxVertexBufferArrayStride",108),x("maxInterStageShaderVariables",112),x("maxColorAttachments",116),x("maxColorAttachmentBytesPerSample",120),x("maxComputeWorkgroupStorageSize",124),x("maxComputeInvocationsPerWorkgroup",128),x("maxComputeWorkgroupSizeX",132),x("maxComputeWorkgroupSizeY",136),x("maxComputeWorkgroupSizeZ",140),x("maxComputeWorkgroupsPerDimension",144),x("maxImmediateSize",148,!0),h.requiredLimits=R}(y=E()[f+24>>>2>>>0])&&(y={label:Ve(y+4)},h.defaultQueue=y),h.label=Ve(f+4)}se+=1,Et(t,e.requestDevice(h).then(x=>{--se,pe(l,x.queue),pe(o,x),i&&(se+=1,Et(i,x.lost.then(B=>{--se,x.onuncapturederror=()=>{};var F=Ie(),z=Fe(B.message);Mr(i,Hs[B.reason],z),Ee(F)}))),x.onuncapturederror=B=>{var F=5;B.error instanceof GPUValidationError?F=2:B.error instanceof GPUOutOfMemoryError?F=3:B.error instanceof GPUInternalError&&(F=4);var z=Ie();B=Fe(B.error.message),Xi(o,F,B),Ee(z)},Lr(t,1,o,0)},x=>{--se;var B=Ie();x=Fe(x.message),Lr(t,3,o,x),i&&Mr(i,4,x),Ee(B)}))}function Qs(e){var t=U(e>>>=0),i=Le[e];if(i){for(var o=0;o<i.length;++o)i[o]();delete Le[e]}t.destroy()}var dt=()=>{var e="getMappedRange size=0 no longer means WGPU_WHOLE_MAP_SIZE";dt.kc||(dt.kc={}),dt.kc[e]||(dt.kc[e]=1,k(e))};function el(e,t,i){t>>>=0,i>>>=0;var o=U(e>>>=0);i===0&&dt(),i==4294967295&&(i=void 0);try{var l=o.getMappedRange(t,i)}catch{return 0}var f=Dr(16,l.byteLength);return ae().set(new Uint8Array(l),f>>>0),Le[e].push(()=>Se(f)),f}function tl(e,t,i){t>>>=0,i>>>=0;var o=U(e>>>=0);i===0&&dt(),i==4294967295&&(i=void 0);try{var l=o.getMappedRange(t,i)}catch{return 0}var f=Dr(16,l.byteLength);return ae().fill(0,f,l.byteLength),Le[e].push(()=>{new Uint8Array(l).set(ae().subarray(f>>>0,f+l.byteLength>>>0)),Se(f)}),f}function rl(e,t,i,o,l){e>>>=0,t=we(t),i=we(i),l>>>=0;var f=U(e);Le[e]=[],l==4294967295&&(l=void 0),se+=1,Et(t,f.mapAsync(i,o>>>0,l).then(()=>{--se,Ur(t,1,0)},h=>{--se,Ie();var y=Fe(h.message);Ur(t,h.name==="AbortError"?4:h.name==="OperationError"?3:0,y),delete Le[e]}))}function nl(e){var t=U(e>>>=0),i=Le[e];if(i){for(var o=0;o<i.length;++o)i[o]();delete Le[e],t.unmap()}}function il(e){delete Er[e>>>0]}function al(e,t,i){e>>>=0,t>>>=0,i>>>=0;var o=!!E()[t+32>>>2>>>0];t={label:Ve(t+4),usage:E()[t+16>>>2>>>0],size:4294967296*E()[t+28>>>2>>>0]+E()[t+24>>>2>>>0],mappedAtCreation:o},e=U(e);try{var l=e.createBuffer(t)}catch{return!1}return pe(i,l),o&&(Le[i]=[]),!0}function ol(e,t,i){e>>>=0,t>>>=0,i>>>=0;var o=E()[t>>>2>>>0],l=E()[o+4>>>2>>>0];t={label:Ve(t+4),code:""},l===2&&(t.code=Ei(o+8)),pe(i,U(e).createShaderModule(t))}var sl=e=>{U(e).destroy()};function ll(e,t){t=we(t),e=U(e>>>0),se+=1,Et(t,e.popErrorScope().then(i=>{--se;var o=5;i?i instanceof GPUValidationError?o=2:i instanceof GPUOutOfMemoryError?o=3:i instanceof GPUInternalError&&(o=4):o=1;var l=Ie();i=i?Fe(i.message):0,Br(t,1,o,i),Ee(l)},i=>{--se;var o=Ie();i=Fe(i.message),Br(t,1,5,i),Ee(o)}))}function ul(e,t,i,o){if(t=we(t),o>>>=0,i>>>=0){var l=E()[i+4>>>2>>>0];l={featureLevel:Zs[l],powerPreference:Xs[E()[i+8>>>2>>>0]],forceFallbackAdapter:!!E()[i+12>>>2>>>0]},(i=E()[i>>>2>>>0])!==0&&(E(),l.rd=!!E()[i+8>>>2>>>0])}"gpu"in navigator?(se+=1,Et(t,navigator.gpu.requestAdapter(l).then(f=>{if(--se,f)pe(o,f),It(t,1,o,0);else{f=Ie();var h=Fe("WebGPU not available on this browser (requestAdapter returned null)");It(t,3,o,h),Ee(f)}},f=>{--se;var h=Ie();f=Fe(f.message),It(t,4,o,f),Ee(h)}))):(i=Ie(),l=Fe("WebGPU not available on this browser (navigator.gpu is not available)"),It(t,3,o,l),Ee(i))}function fl(e,t,i){return e>>>=0,t>>>=0,i>>>=0,mi(async()=>{var o=[];if(i){var l=M()[i>>>2>>>0];o.length=t+1,o[t]=new Promise(y=>setTimeout(y,l,0))}else o.length=t;for(var f=0;f<t;++f){var h=4294967296*E()[e+8*f+4>>>2>>>0]+E()[e+8*f>>>2>>>0];if(!(h in zt))return h;o[f]=zt[h]}return o=await Promise.race(o),delete zt[o],o})}var Or,Ar={},Oi=()=>{if(!Or){var e,t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(e in Ar)Ar[e]===void 0?delete t[e]:t[e]=Ar[e];var i=[];for(e in t)i.push(`${e}=${t[e]}`);Or=i}return Or};function Ai(e,t){if(p)return Q(19,1,e,t);e>>>=0,t>>>=0;var i,o=0,l=0;for(i of Oi()){var f=t+o;E()[e+l>>>2>>>0]=f,o+=We(i,f,1/0)+1,l+=4}return 0}function Ri(e,t){if(p)return Q(20,1,e,t);e>>>=0,t>>>=0;var i=Oi();for(var o of(E()[e>>>2>>>0]=i.length,e=0,i))e+=Ge(o)+1;return E()[t>>>2>>>0]=e,0}function Si(e){return p?Q(21,1,e):52}function Pi(e,t,i,o){return p?Q(22,1,e,t,i,o):52}function Mi(e,t,i,o){return p?Q(23,1,e,t,i,o):70}var cl=[null,[],[]];function Ui(e,t,i,o){if(p)return Q(24,1,e,t,i,o);t>>>=0,i>>>=0,o>>>=0;for(var l=0,f=0;f<i;f++){var h=E()[t>>>2>>>0],y=E()[t+4>>>2>>>0];t+=8;for(var b=0;b<y;b++){var _=e,R=ae()[h+b>>>0],x=cl[_];R===0||R===10?((_===1?$e:k)(Zn(x)),x.length=0):x.push(R)}l+=y}return E()[o>>>2>>>0]=l,0}function dl(e,t){return Ii(U(e>>>0).limits,t>>>0),1}function pl(e,t){return U(e>>>0).features.has(Ir[t])}function hl(e){return BigInt(U(e>>>0).size)}function ml(e){return BigInt(U(e>>>0).usage)}function yl(e,t){if(e>>>=0,t>>>=0){var i=Ve(t+4);i={label:i,timestampWrites:t=(t=E()[t+12>>>2>>>0])!==0?{querySet:U(E()[t+4>>>2>>>0]),beginningOfPassWriteIndex:E()[t+8>>>2>>>0],endOfPassWriteIndex:E()[t+12>>>2>>>0]}:void 0}}return e=U(e),t=Fi(0),pe(t,e.beginComputePass(i)),t}function gl(e,t,i,o,l,f){i=we(i),l=we(l),f=we(f),U(e>>>0).copyBufferToBuffer(U(t>>>0),i,U(o>>>0),l,f)}function wl(e){e=U(e>>>0);var t=Wi(0);return pe(t,e.finish()),t}function vl(e,t,i,o,l,f){f=we(f),U(e>>>0).resolveQuerySet(U(t>>>0),i,o,U(l>>>0),f)}function bl(e,t,i,o){U(e>>>0).dispatchWorkgroups(t,i,o)}function Cl(e){U(e>>>0).end()}function Tl(e,t,i,o,l){o>>>=0,l>>>=0,e=U(e>>>0),i=U(i>>>0),o==0?e.setBindGroup(t,i):e.setBindGroup(t,i,E(),l>>>2,o)}function _l(e,t){U(e>>>0).setPipeline(U(t>>>0))}function xl(e,t,i){U(e>>>0).qd(U(t>>>0),i)}function El(e,t){e=U(e>>>0);var i=Ni(0);return pe(i,e.getBindGroupLayout(t)),i}function Il(e,t){e>>>=0;var i=Ve(4+(t>>>=0)),o=U(E()[t+12>>>2>>>0]),l=E()[t+16>>>2>>>0];t=E()[t+20>>>2>>>0];for(var f=[],h=0;h<l;++h){var y=f,b=y.push,_=t+40*h,R=E()[_+8>>>2>>>0],x=E()[_+32>>>2>>>0],B=E()[_+36>>>2>>>0],F=E()[_+4>>>2>>>0];R?(x=_+24,(x=E()[x>>>2>>>0]+4294967296*M()[x+4>>>2>>>0])==-1&&(x=void 0),_={binding:F,resource:{buffer:U(R),offset:4294967296*E()[_+4+16>>>2>>>0]+E()[_+16>>>2>>>0],size:x}}):_=x?{binding:F,resource:U(x)}:{binding:F,resource:U(B)},b.call(y,_)}return i={label:i,layout:o,entries:f},e=U(e),o=ki(0),pe(o,e.createBindGroup(i)),o}function Ol(e,t){var i;return e>>>=0,(t>>>=0)&&(i={label:Ve(t+4)}),e=U(e),t=Gi(0),pe(t,e.createCommandEncoder(i)),t}function Al(e,t){e>>>=0;var i=t>>>0;t=Ve(i+4);var o=(o=E()[i+12>>>2>>>0])?U(o):"auto";if(i+=16){var l=U(E()[i+4>>>2>>>0]),f=E()[i+16>>>2>>>0],h=E()[i+20>>>2>>>0];if(f){for(var y={},b=0;b<f;++b){var _=h+24*b;y[Ei(_+4)]=ge()[_+16>>>3>>>0]}f=y}else f=void 0;i={module:l,constants:f,entryPoint:Ve(i+8)}}else i=void 0;return t={label:t,layout:o,compute:i},e=U(e),o=Vi(0),pe(o,e.createComputePipeline(t)),o}function Rl(e,t){e>>>=0,t>>>=0,t={type:Ys[E()[t+12>>>2>>>0]],count:E()[t+16>>>2>>>0]},e=U(e);var i=zi(0);return pe(i,e.createQuerySet(t)),i}function Sl(e,t){e=U(e>>>0).adapterInfo,t>>>=0,M()[t+52>>>2>>>0]=e.subgroupMinSize,M()[t+56>>>2>>>0]=e.subgroupMaxSize;var i=e.vendor+e.architecture+e.device+e.description,o=Ge(i)+1,l=pt(o);return l&&We(i,l,o),i=l,o=Ge(e.vendor),Ht(t+4,i,o),i+=o,o=Ge(e.architecture),Ht(t+12,i,o),i+=o,o=Ge(e.device),Ht(t+20,i,o),Ht(t+28,i+o,Ge(e.description)),M()[t+36>>>2>>>0]=2,e=e.isFallbackAdapter?3:4,M()[t+40>>>2>>>0]=e,M()[t+44>>>2>>>0]=0,M()[t+48>>>2>>>0]=0,1}function Pl(e,t){t>>>=0,e=U(e>>>0);var i=pt(4*e.features.size),o=0,l=0;e.features.forEach(f=>{(f=Js[f])!==void 0&&(M()[i+o>>>2>>>0]=f,o+=4,l++)}),E()[t+4>>>2>>>0]=i,E()[t>>>2>>>0]=l}function Ml(e,t){return Ii(U(e>>>0).limits,t>>>0),1}function Ul(e,t){return U(e>>>0).features.has(Ir[t])}function Bl(e,t){U(e>>>0).pushErrorScope(qs[t])}function Ll(e,t,i){t>>>=0,i>>>=0,e=U(e>>>0),t=Array.from(M().subarray(i>>>2>>>0,i+4*t>>>2>>>0),o=>U(o)),e.submit(t)}function $l(e,t,i,o,l){i=we(i),o>>>=0,l>>>=0,e=U(e>>>0),t=U(t>>>0),o=ae().subarray(o>>>0,o+l>>>0),e.writeBuffer(t,i,o,0,l)}p||(function(){for(var e=n.numThreads-1;e--;)Vn();dr.push(()=>{je++,(function(t){p?t():Promise.all(ze.map(Fn)).then(t)})(()=>Ln())})})();for(var Bi=Array(256),qt=0;256>qt;++qt)Bi[qt]=String.fromCharCode(qt);li=Bi,Ne.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=()=>Ne.length/2-5-gr.length,p||(S=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),G()),n.wasmBinary&&($=n.wasmBinary),n.stackSave=()=>Ie(),n.stackRestore=e=>Ee(e),n.stackAlloc=e=>Zt(e),n.setValue=function(e,t,i="i8"){switch(i.endsWith("*")&&(i="*"),i){case"i1":case"i8":K()[e>>>0]=t;break;case"i16":Re()[e>>>1>>>0]=t;break;case"i32":M()[e>>>2>>>0]=t;break;case"i64":re[e>>>3]=BigInt(t);break;case"float":Te()[e>>>2>>>0]=t;break;case"double":ge()[e>>>3>>>0]=t;break;case"*":E()[e>>>2>>>0]=t;break;default:De(`invalid type for setValue: ${i}`)}},n.getValue=function(e,t="i8"){switch(t.endsWith("*")&&(t="*"),t){case"i1":case"i8":return K()[e>>>0];case"i16":return Re()[e>>>1>>>0];case"i32":return M()[e>>>2>>>0];case"i64":return re[e>>>3];case"float":return Te()[e>>>2>>>0];case"double":return ge()[e>>>3>>>0];case"*":return E()[e>>>2>>>0];default:De(`invalid type for getValue: ${t}`)}},n.UTF8ToString=ft,n.stringToUTF8=We,n.lengthBytesUTF8=Ge;var jl=[pr,kn,zn,Xn,Yn,Jn,Kn,Qn,ei,ti,ri,ni,ii,ai,oi,si,bi,Ci,Ti,Ai,Ri,Si,Pi,Mi,Ui],Rr={1048636:(e,t,i,o,l)=>{if(n===void 0||!n.fc)return 1;if((e=ft(Number(e>>>0))).startsWith("./")&&(e=e.substring(2)),!(e=n.fc.get(e)))return 2;if(t=Number(t>>>0),i=Number(i>>>0),o=Number(o>>>0),t+i>e.byteLength)return 3;try{let f=e.subarray(t,t+i);switch(l){case 0:ae().set(f,o>>>0);break;case 1:n.Pc?n.Pc(o,f):n.jd(o,f);break;default:return 4}return 0}catch{return 4}},1049460:(e,t,i)=>{n.Rc(e,ae().subarray(t>>>0,t+i>>>0))},1049524:()=>n.ed(),1049566:e=>{n.Qc(e)},1049603:()=>typeof wasmOffsetConverter<"u"};function Dl(){return typeof wasmOffsetConverter<"u"}var w=await(async function(){function e(o,l){return w=o.exports,w=(function(){var f=w,h={};for(let[y,b]of Object.entries(f))h[y]=typeof b=="function"?(..._)=>{Wt.push(y);try{return b(..._)}finally{ue||(Wt.pop(),Be&&qe===1&&Wt.length===0&&(qe=0,se+=1,Nt(ia),typeof Fibers<"u"&&Fibers.od()))}}:b;return h})(),w=(function(){var f=w,h=b=>_=>b(_)>>>0,y=b=>()=>b()>>>0;return(f=Object.assign({},f)).ob=h(f.ob),f.Rb=y(f.Rb),f.Tb=h(f.Tb),f.Dc=(b=>(_,R)=>b(_,R)>>>0)(f.Dc),f.Gc=h(f.Gc),f.Hc=y(f.Hc),f.__cxa_get_exception_ptr=h(f.__cxa_get_exception_ptr),f})(),Nn.push(w.vc),A=l,Ln(),w}je++;var t=$n();if(n.instantiateWasm)return new Promise(o=>{n.instantiateWasm(t,(l,f)=>{o(e(l,f))})});if(p)return new Promise(o=>{ye=l=>{var f=new WebAssembly.Instance(l,$n());o(e(f,l))}});Ke??=n.locateFile?n.locateFile?n.locateFile("ort-wasm-simd-threaded.asyncify.wasm",O):O+"ort-wasm-simd-threaded.asyncify.wasm":new URL("/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",import.meta.url).href;try{var i=await(async function(o){var l=Ke;if(!$&&typeof WebAssembly.instantiateStreaming=="function"&&!X(l))try{var f=fetch(l,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(f,o)}catch(h){k(`wasm streaming compile failed: ${h}`),k("falling back to ArrayBuffer instantiation")}return(async function(h,y){try{var b=await(async function(_){if(!$)try{var R=await v(_);return new Uint8Array(R)}catch{}if(_==Ke&&$)_=new Uint8Array($);else{if(!C)throw"both async and sync fetching of the wasm failed";_=C(_)}return _})(h);return await WebAssembly.instantiate(b,y)}catch(_){k(`failed to asynchronously prepare wasm: ${_}`),De(_)}})(l,o)})(t);return e(i.instance,i.module)}catch(o){return s(o),Promise.reject(o)}})(),Li=e=>(Li=w.ob)(e),$i=()=>($i=w.pb)();n._OrtInit=(e,t)=>(n._OrtInit=w.qb)(e,t),n._OrtGetLastError=(e,t)=>(n._OrtGetLastError=w.rb)(e,t),n._OrtCreateSessionOptions=(e,t,i,o,l,f,h,y,b,_)=>(n._OrtCreateSessionOptions=w.sb)(e,t,i,o,l,f,h,y,b,_),n._OrtAppendExecutionProvider=(e,t,i,o,l)=>(n._OrtAppendExecutionProvider=w.tb)(e,t,i,o,l),n._OrtAddFreeDimensionOverride=(e,t,i)=>(n._OrtAddFreeDimensionOverride=w.ub)(e,t,i),n._OrtAddSessionConfigEntry=(e,t,i)=>(n._OrtAddSessionConfigEntry=w.vb)(e,t,i),n._OrtReleaseSessionOptions=e=>(n._OrtReleaseSessionOptions=w.wb)(e),n._OrtCreateSession=(e,t,i)=>(n._OrtCreateSession=w.xb)(e,t,i),n._OrtReleaseSession=e=>(n._OrtReleaseSession=w.yb)(e),n._OrtGetInputOutputCount=(e,t,i)=>(n._OrtGetInputOutputCount=w.zb)(e,t,i),n._OrtGetInputOutputMetadata=(e,t,i,o)=>(n._OrtGetInputOutputMetadata=w.Ab)(e,t,i,o),n._OrtFree=e=>(n._OrtFree=w.Bb)(e),n._OrtCreateTensor=(e,t,i,o,l,f)=>(n._OrtCreateTensor=w.Cb)(e,t,i,o,l,f),n._OrtGetTensorData=(e,t,i,o,l)=>(n._OrtGetTensorData=w.Db)(e,t,i,o,l),n._OrtReleaseTensor=e=>(n._OrtReleaseTensor=w.Eb)(e),n._OrtCreateRunOptions=(e,t,i,o)=>(n._OrtCreateRunOptions=w.Fb)(e,t,i,o),n._OrtAddRunConfigEntry=(e,t,i)=>(n._OrtAddRunConfigEntry=w.Gb)(e,t,i),n._OrtReleaseRunOptions=e=>(n._OrtReleaseRunOptions=w.Hb)(e),n._OrtCreateBinding=e=>(n._OrtCreateBinding=w.Ib)(e),n._OrtBindInput=(e,t,i)=>(n._OrtBindInput=w.Jb)(e,t,i),n._OrtBindOutput=(e,t,i,o)=>(n._OrtBindOutput=w.Kb)(e,t,i,o),n._OrtClearBoundOutputs=e=>(n._OrtClearBoundOutputs=w.Lb)(e),n._OrtReleaseBinding=e=>(n._OrtReleaseBinding=w.Mb)(e),n._OrtRunWithBinding=(e,t,i,o,l)=>(n._OrtRunWithBinding=w.Nb)(e,t,i,o,l),n._OrtRun=(e,t,i,o,l,f,h,y)=>(n._OrtRun=w.Ob)(e,t,i,o,l,f,h,y),n._OrtEndProfiling=e=>(n._OrtEndProfiling=w.Pb)(e);var Sr=n._OrtGetWebGpuDevice=e=>(Sr=n._OrtGetWebGpuDevice=w.Qb)(e),Pr=()=>(Pr=w.Rb)(),Se=n._free=e=>(Se=n._free=w.Sb)(e),pt=n._malloc=e=>(pt=n._malloc=w.Tb)(e),ji=n._wgpuBufferRelease=e=>(ji=n._wgpuBufferRelease=w.Ub)(e),Di=n._wgpuCreateInstance=e=>(Di=n._wgpuCreateInstance=w.Vb)(e),ki=e=>(ki=w.Wb)(e),Ni=e=>(Ni=w.Xb)(e),Wi=e=>(Wi=w.Yb)(e),Gi=e=>(Gi=w.Zb)(e),Fi=e=>(Fi=w._b)(e),Vi=e=>(Vi=w.$b)(e),zi=e=>(zi=w.bc)(e),Hi=(e,t)=>(Hi=w.lc)(e,t),qi=(e,t)=>(qi=w.mc)(e,t),Zi=e=>(Zi=w.nc)(e),Mr=(e,t,i)=>(Mr=w.pc)(e,t,i),Ur=(e,t,i)=>(Ur=w.qc)(e,t,i),Br=(e,t,i,o)=>(Br=w.rc)(e,t,i,o),It=(e,t,i,o)=>(It=w.sc)(e,t,i,o),Lr=(e,t,i,o)=>(Lr=w.tc)(e,t,i,o),Xi=(e,t,i)=>(Xi=w.uc)(e,t,i),$r=(e,t,i,o,l,f)=>($r=w.wc)(e,t,i,o,l,f),Yi=()=>(Yi=w.xc)(),Ji=(e,t,i,o,l)=>(Ji=w.yc)(e,t,i,o,l),Ki=e=>(Ki=w.zc)(e),jr=e=>(jr=w.Ac)(e),Qi=(e,t)=>(Qi=w.Bc)(e,t),ea=()=>(ea=w.Cc)(),Dr=(e,t)=>(Dr=w.Dc)(e,t),ta=(e,t)=>(ta=w.Ec)(e,t),Ee=e=>(Ee=w.Fc)(e),Zt=e=>(Zt=w.Gc)(e),Ie=()=>(Ie=w.Hc)(),ra=n.dynCall_ii=(e,t)=>(ra=n.dynCall_ii=w.Ic)(e,t);n.dynCall_viiii=(e,t,i,o,l)=>(n.dynCall_viiii=w.dynCall_viiii)(e,t,i,o,l),n.dynCall_viiiii=(e,t,i,o,l,f)=>(n.dynCall_viiiii=w.dynCall_viiiii)(e,t,i,o,l,f),n.dynCall_viii=(e,t,i,o)=>(n.dynCall_viii=w.Jc)(e,t,i,o),n.dynCall_vi=(e,t)=>(n.dynCall_vi=w.dynCall_vi)(e,t),n.dynCall_viijj=(e,t,i,o,l)=>(n.dynCall_viijj=w.dynCall_viijj)(e,t,i,o,l),n.dynCall_viiiiii=(e,t,i,o,l,f,h)=>(n.dynCall_viiiiii=w.dynCall_viiiiii)(e,t,i,o,l,f,h),n.dynCall_viiiiiiii=(e,t,i,o,l,f,h,y,b)=>(n.dynCall_viiiiiiii=w.dynCall_viiiiiiii)(e,t,i,o,l,f,h,y,b),n.dynCall_i=e=>(n.dynCall_i=w.dynCall_i)(e),n.dynCall_vii=(e,t,i)=>(n.dynCall_vii=w.dynCall_vii)(e,t,i),n.dynCall_fffffff=(e,t,i,o,l,f,h)=>(n.dynCall_fffffff=w.dynCall_fffffff)(e,t,i,o,l,f,h),n.dynCall_iiiii=(e,t,i,o,l)=>(n.dynCall_iiiii=w.dynCall_iiiii)(e,t,i,o,l),n.dynCall_iii=(e,t,i)=>(n.dynCall_iii=w.dynCall_iii)(e,t,i),n.dynCall_iiiiii=(e,t,i,o,l,f)=>(n.dynCall_iiiiii=w.dynCall_iiiiii)(e,t,i,o,l,f),n.dynCall_iiiiiiii=(e,t,i,o,l,f,h,y)=>(n.dynCall_iiiiiiii=w.dynCall_iiiiiiii)(e,t,i,o,l,f,h,y),n.dynCall_iiiiiii=(e,t,i,o,l,f,h)=>(n.dynCall_iiiiiii=w.dynCall_iiiiiii)(e,t,i,o,l,f,h),n.dynCall_iiii=(e,t,i,o)=>(n.dynCall_iiii=w.dynCall_iiii)(e,t,i,o),n.dynCall_vfiii=(e,t,i,o,l)=>(n.dynCall_vfiii=w.dynCall_vfiii)(e,t,i,o,l),n.dynCall_viiiiff=(e,t,i,o,l,f,h)=>(n.dynCall_viiiiff=w.dynCall_viiiiff)(e,t,i,o,l,f,h),n.dynCall_viiiiiff=(e,t,i,o,l,f,h,y)=>(n.dynCall_viiiiiff=w.dynCall_viiiiiff)(e,t,i,o,l,f,h,y),n.dynCall_ffff=(e,t,i,o)=>(n.dynCall_ffff=w.dynCall_ffff)(e,t,i,o),n.dynCall_viiff=(e,t,i,o,l)=>(n.dynCall_viiff=w.dynCall_viiff)(e,t,i,o,l),n.dynCall_jjjjjjj=(e,t,i,o,l,f,h)=>(n.dynCall_jjjjjjj=w.dynCall_jjjjjjj)(e,t,i,o,l,f,h),n.dynCall_jjjjjj=(e,t,i,o,l,f)=>(n.dynCall_jjjjjj=w.dynCall_jjjjjj)(e,t,i,o,l,f),n.dynCall_iijjii=(e,t,i,o,l,f)=>(n.dynCall_iijjii=w.dynCall_iijjii)(e,t,i,o,l,f),n.dynCall_viiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F)=>(n.dynCall_viiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F),n.dynCall_viiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R)=>(n.dynCall_viiiiiiiiii=w.dynCall_viiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R),n.dynCall_viiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x)=>(n.dynCall_viiiiiiiiiii=w.dynCall_viiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x),n.dynCall_viiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B)=>(n.dynCall_viiiiiiiiiiii=w.dynCall_viiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B),n.dynCall_viiiiiiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et,Ot)=>(n.dynCall_viiiiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et,Ot),n.dynCall_viiiiiiiii=(e,t,i,o,l,f,h,y,b,_)=>(n.dynCall_viiiiiiiii=w.dynCall_viiiiiiiii)(e,t,i,o,l,f,h,y,b,_),n.dynCall_viiiiiiiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et,Ot,kr)=>(n.dynCall_viiiiiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et,Ot,kr),n.dynCall_viiiiiii=(e,t,i,o,l,f,h,y)=>(n.dynCall_viiiiiii=w.dynCall_viiiiiii)(e,t,i,o,l,f,h,y),n.dynCall_viiiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he)=>(n.dynCall_viiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he),n.dynCall_jiji=(e,t,i,o)=>(n.dynCall_jiji=w.dynCall_jiji)(e,t,i,o),n.dynCall_v=e=>(n.dynCall_v=w.dynCall_v)(e),n.dynCall_iidiiii=(e,t,i,o,l,f,h)=>(n.dynCall_iidiiii=w.dynCall_iidiiii)(e,t,i,o,l,f,h),n.dynCall_ji=(e,t)=>(n.dynCall_ji=w.dynCall_ji)(e,t),n.dynCall_vij=(e,t,i)=>(n.dynCall_vij=w.dynCall_vij)(e,t,i),n.dynCall_viiijii=(e,t,i,o,l,f,h)=>(n.dynCall_viiijii=w.dynCall_viiijii)(e,t,i,o,l,f,h),n.dynCall_viijiiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et)=>(n.dynCall_viijiiiiiiiiiiiiii=w.dynCall_viijiiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et),n.dynCall_viiiji=(e,t,i,o,l,f)=>(n.dynCall_viiiji=w.dynCall_viiiji)(e,t,i,o,l,f),n.dynCall_jfi=(e,t,i)=>(n.dynCall_jfi=w.dynCall_jfi)(e,t,i),n.dynCall_fif=(e,t,i)=>(n.dynCall_fif=w.dynCall_fif)(e,t,i),n.dynCall_jii=(e,t,i)=>(n.dynCall_jii=w.dynCall_jii)(e,t,i),n.dynCall_viiiijii=(e,t,i,o,l,f,h,y)=>(n.dynCall_viiiijii=w.dynCall_viiiijii)(e,t,i,o,l,f,h,y),n.dynCall_iij=(e,t,i)=>(n.dynCall_iij=w.dynCall_iij)(e,t,i),n.dynCall_viji=(e,t,i,o)=>(n.dynCall_viji=w.dynCall_viji)(e,t,i,o),n.dynCall_iiiiiiiii=(e,t,i,o,l,f,h,y,b)=>(n.dynCall_iiiiiiiii=w.dynCall_iiiiiiiii)(e,t,i,o,l,f,h,y,b),n.dynCall_iiij=(e,t,i,o)=>(n.dynCall_iiij=w.dynCall_iiij)(e,t,i,o),n.dynCall_iiiiiiiiii=(e,t,i,o,l,f,h,y,b,_)=>(n.dynCall_iiiiiiiiii=w.dynCall_iiiiiiiiii)(e,t,i,o,l,f,h,y,b,_),n.dynCall_iiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B)=>(n.dynCall_iiiiiiiiiiiii=w.dynCall_iiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B),n.dynCall_iiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R)=>(n.dynCall_iiiiiiiiiii=w.dynCall_iiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R),n.dynCall_iijii=(e,t,i,o,l)=>(n.dynCall_iijii=w.dynCall_iijii)(e,t,i,o,l),n.dynCall_fiii=(e,t,i,o)=>(n.dynCall_fiii=w.dynCall_fiii)(e,t,i,o),n.dynCall_viijii=(e,t,i,o,l,f)=>(n.dynCall_viijii=w.dynCall_viijii)(e,t,i,o,l,f),n.dynCall_viij=(e,t,i,o)=>(n.dynCall_viij=w.dynCall_viij)(e,t,i,o),n.dynCall_jiij=(e,t,i,o)=>(n.dynCall_jiij=w.dynCall_jiij)(e,t,i,o),n.dynCall_fi=(e,t)=>(n.dynCall_fi=w.dynCall_fi)(e,t),n.dynCall_fii=(e,t,i)=>(n.dynCall_fii=w.dynCall_fii)(e,t,i),n.dynCall_dii=(e,t,i)=>(n.dynCall_dii=w.dynCall_dii)(e,t,i),n.dynCall_fiiii=(e,t,i,o,l)=>(n.dynCall_fiiii=w.dynCall_fiiii)(e,t,i,o,l),n.dynCall_viiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z)=>(n.dynCall_viiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z),n.dynCall_viiiiiiiiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et,Ot,kr,kl)=>(n.dynCall_viiiiiiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe,et,Ot,kr,kl),n.dynCall_viiiiiiiiiiiiiiii=(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe)=>(n.dynCall_viiiiiiiiiiiiiiii=w.dynCall_viiiiiiiiiiiiiiii)(e,t,i,o,l,f,h,y,b,_,R,x,B,F,z,he,Pe),n.dynCall_iif=(e,t,i)=>(n.dynCall_iif=w.dynCall_iif)(e,t,i),n.dynCall_jiiii=(e,t,i,o,l)=>(n.dynCall_jiiii=w.dynCall_jiiii)(e,t,i,o,l),n.dynCall_jiii=(e,t,i,o)=>(n.dynCall_jiii=w.dynCall_jiii)(e,t,i,o),n.dynCall_viif=(e,t,i,o)=>(n.dynCall_viif=w.dynCall_viif)(e,t,i,o),n.dynCall_viiij=(e,t,i,o,l)=>(n.dynCall_viiij=w.dynCall_viiij)(e,t,i,o,l),n.dynCall_iiiiij=(e,t,i,o,l,f)=>(n.dynCall_iiiiij=w.dynCall_iiiiij)(e,t,i,o,l,f),n.dynCall_iiiiid=(e,t,i,o,l,f)=>(n.dynCall_iiiiid=w.dynCall_iiiiid)(e,t,i,o,l,f),n.dynCall_iiiiijj=(e,t,i,o,l,f,h)=>(n.dynCall_iiiiijj=w.dynCall_iiiiijj)(e,t,i,o,l,f,h),n.dynCall_iiiiiijj=(e,t,i,o,l,f,h,y)=>(n.dynCall_iiiiiijj=w.dynCall_iiiiiijj)(e,t,i,o,l,f,h,y);var na=e=>(na=w.Kc)(e),ia=()=>(ia=w.Lc)(),aa=e=>(aa=w.Mc)(e),oa=()=>(oa=w.Nc)();return(function e(){if(0<je)Ct=e;else if(p)a(n),_e();else{for(;0<dr.length;)dr.shift()(n);0<je?Ct=e:(n.calledRun=!0,ue||(_e(),a(n)))}})(),n.PTR_SIZE=4,n.webgpuInit=e=>{let t=new WeakMap,i,o,l=1;n.webgpuRegisterDevice=y=>{if(o!==void 0)throw Error("another WebGPU EP inference session is being created.");if(y){var b=t.get(y);if(!b){let _=((R,x=0)=>{var B=Zi(x);return x=qi(x,B),pe(B,R.queue),pe(x,R),x})(y,b=Di(0));b=[l++,b,_],t.set(y,b)}return i=y,o=b[0],b}i=void 0,o=0};let f=new Map;n.webgpuOnCreateSession=y=>{if(o!==void 0){var b=o;if(o=void 0,y){let _=Sr(b);f.set(y,_),b===0&&e(i??U(_))}i=void 0}},n.webgpuOnReleaseSession=y=>{f.delete(y)};let h=Symbol("gpuBufferMetadata");n.webgpuRegisterBuffer=(y,b,_)=>{if(_)return y[h]=[_,NaN],_;if(_=y[h])return _[1]++,_[0];if((b=f.get(b))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");return b=((R,x=0)=>(R.mapState!="pending"||De(),x=Hi(x,R.mapState=="mapped"?3:1),pe(x,R),R.mapState=="mapped"&&(Le[x]=[]),x))(y,b),y[h]=[b,1],b},n.webgpuUnregisterBuffer=y=>{let b=y[h];if(!b)throw Error("Buffer is not registered");b[1]--,b[1]===0&&(ji(b[0]),delete y[h])},n.webgpuGetBuffer=y=>U(y),n.webgpuCreateDownloader=(y,b,_)=>{if((_=f.get(_))===void 0)throw Error("Invalid session handle passed to webgpuRegisterBuffer");let R=U(_),x=16*Math.ceil(Number(b)/16);return async()=>{let B=R.createBuffer({size:x,usage:9});try{let F=R.createCommandEncoder();return F.copyBufferToBuffer(y,0,B,0,x),R.queue.submit([F.finish()]),await B.mapAsync(GPUMapMode.READ),B.getMappedRange().slice(0,b)}finally{B.destroy()}}},n.Pc=(y,b)=>{var _=b.buffer;let R=b.byteOffset,x=b.byteLength;if(b=16*Math.ceil(Number(x)/16),y=U(y),!i){var B=Sr(o);i=U(B)}let F=(B=i.createBuffer({mappedAtCreation:!0,size:b,usage:6})).getMappedRange();new Uint8Array(F).set(new Uint8Array(_,R,x)),B.unmap(),(_=i.createCommandEncoder()).copyBufferToBuffer(B,0,y,0,b),i.queue.submit([_.finish()]),B.destroy()}},n.webnnInit=e=>{let t=e[0];[n.ed,n.Qc,n.webnnEnsureTensor,n.Rc,n.webnnDownloadTensor,n.dd,n.webnnEnableTraceEvent]=e.slice(1),n.webnnReleaseTensorId=n.Qc,n.webnnUploadTensor=n.Rc,n.webnnRegisterMLContext=n.dd,n.webnnOnRunStart=i=>t.onRunStart(i),n.webnnOnRunEnd=t.onRunEnd.bind(t),n.webnnOnReleaseSession=i=>{t.onReleaseSession(i)},n.webnnCreateMLTensorDownloader=(i,o)=>t.createMLTensorDownloader(i,o),n.webnnRegisterMLTensor=(i,o,l,f)=>t.registerMLTensor(i,o,l,f),n.webnnCreateMLContext=i=>t.createMLContext(i),n.webnnRegisterMLConstant=(i,o,l,f,h,y)=>t.registerMLConstant(i,o,l,f,h,n.fc,y),n.webnnRegisterGraphInput=t.registerGraphInput.bind(t),n.webnnIsGraphInput=t.isGraphInput.bind(t),n.webnnRegisterGraphOutput=t.registerGraphOutput.bind(t),n.webnnIsGraphOutput=t.isGraphOutput.bind(t),n.webnnCreateTemporaryTensor=t.createTemporaryTensor.bind(t),n.webnnIsGraphInputOutputTypeSupported=t.isGraphInputOutputTypeSupported.bind(t)},u},no=zr,la=globalThis.self?.name?.startsWith("em-pthread"),la&&zr()}),Hr,dn,ua,ve,io,Yt,fa,ca,qr,da,Zr,ao,Xr,oo,Tn=W(()=>{Cn(),Hr=typeof location>"u"?void 0:location.origin,dn=import.meta.url>"file:"&&import.meta.url<"file;",ua=()=>{{if(dn){let r=URL;return new URL(new r("ort.webgpu.bundle.min.mjs",import.meta.url).href,Hr).href}return import.meta.url}},ve=ua(),io=()=>{if(ve&&!ve.startsWith("blob:"))return ve.substring(0,ve.lastIndexOf("/")+1)},Yt=(r,a)=>{try{let s=a??ve;return(s?new URL(r,s):new URL(r)).origin===Hr}catch{return!1}},fa=(r,a)=>{let s=a??ve;try{return(s?new URL(r,s):new URL(r)).href}catch{return}},ca=(r,a)=>`${a??"./"}${r}`,qr=async r=>{let a=await(await fetch(r,{credentials:"same-origin"})).blob();return URL.createObjectURL(a)},da=async r=>(await import(r)).default,Zr=(au(),ar(eo)).default,ao=async()=>{if(!ve)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(Yt(ve))return[void 0,Zr()];let r=await qr(ve);return[r,Zr(r)]},Xr=(ou(),ar(ro)).default,oo=async(r,a,s,n)=>{let u=Xr&&!(r||a);if(u)if(ve)u=Yt(ve);else if(n&&!s)u=!0;else throw new Error("cannot determine the script source URL.");if(u)return[void 0,Xr];{let c="ort-wasm-simd-threaded.asyncify.mjs",d=r??fa(c,a),p=s&&d&&!Yt(d,a),m=p?await qr(d):d??ca(c,a);return[p?m:void 0,await da(m)]}}}),Yr,Jt,Rt,Jr,pa,ha,ma,_n,Z,lt=W(()=>{Tn(),Jt=!1,Rt=!1,Jr=!1,pa=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},ha=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},ma=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},_n=async r=>{if(Jt)return Promise.resolve();if(Rt)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(Jr)throw new Error("previous call to 'initializeWebAssembly()' failed.");Rt=!0;let a=r.initTimeout,s=r.numThreads;if(r.simd!==!1){if(r.simd==="relaxed"){if(!ma())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!ha())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let n=pa();s>1&&!n&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+s+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),r.numThreads=s=1);let u=r.wasmPaths,c=typeof u=="string"?u:void 0,d=u?.mjs,p=d?.href??d,m=u?.wasm,g=m?.href??m,v=r.wasmBinary,[C,T]=await oo(p,c,s>1,!!v||!!g),I=!1,O=[];if(a>0&&O.push(new Promise($=>{setTimeout(()=>{I=!0,$()},a)})),O.push(new Promise(($,S)=>{let A={numThreads:s};if(v)A.wasmBinary=v;else if(g||c)A.locateFile=P=>g??c+P;else if(p&&p.indexOf("blob:")!==0)A.locateFile=P=>new URL(P,p).href;else if(C){let P=io();P&&(A.locateFile=D=>P+D)}T(A).then(P=>{Rt=!1,Jt=!0,Yr=P,$(),C&&URL.revokeObjectURL(C)},P=>{Rt=!1,Jr=!0,S(P)})})),await Promise.race(O),I)throw new Error(`WebAssembly backend initializing failed due to timeout: ${a}ms`)},Z=()=>{if(Jt&&Yr)return Yr;throw new Error("WebAssembly is not initialized yet.")}}),be,or,H,xn=W(()=>{lt(),be=(r,a)=>{let s=Z(),n=s.lengthBytesUTF8(r)+1,u=s._malloc(n);return s.stringToUTF8(r,u,n),a.push(u),u},or=(r,a,s,n)=>{if(typeof r=="object"&&r!==null){if(s.has(r))throw new Error("Circular reference in options");s.add(r)}Object.entries(r).forEach(([u,c])=>{let d=a?a+u:u;if(typeof c=="object")or(c,d+".",s,n);else if(typeof c=="string"||typeof c=="number")n(d,c.toString());else if(typeof c=="boolean")n(d,c?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof c}`)})},H=r=>{let a=Z(),s=a.stackSave();try{let n=a.PTR_SIZE,u=a.stackAlloc(2*n);a._OrtGetLastError(u,u+n);let c=Number(a.getValue(u,n===4?"i32":"i64")),d=a.getValue(u+n,"*"),p=d?a.UTF8ToString(d):"";throw new Error(`${r} ERROR_CODE: ${c}, ERROR_MESSAGE: ${p}`)}finally{a.stackRestore(s)}}}),so,su=W(()=>{lt(),xn(),so=r=>{let a=Z(),s=0,n=[],u=r||{};try{if(r?.logSeverityLevel===void 0)u.logSeverityLevel=2;else if(typeof r.logSeverityLevel!="number"||!Number.isInteger(r.logSeverityLevel)||r.logSeverityLevel<0||r.logSeverityLevel>4)throw new Error(`log severity level is not valid: ${r.logSeverityLevel}`);if(r?.logVerbosityLevel===void 0)u.logVerbosityLevel=0;else if(typeof r.logVerbosityLevel!="number"||!Number.isInteger(r.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${r.logVerbosityLevel}`);r?.terminate===void 0&&(u.terminate=!1);let c=0;return r?.tag!==void 0&&(c=be(r.tag,n)),s=a._OrtCreateRunOptions(u.logSeverityLevel,u.logVerbosityLevel,!!u.terminate,c),s===0&&H("Can't create run options."),r?.extra!==void 0&&or(r.extra,"",new WeakSet,(d,p)=>{let m=be(d,n),g=be(p,n);a._OrtAddRunConfigEntry(s,m,g)!==0&&H(`Can't set a run config entry: ${d} - ${p}.`)}),[s,n]}catch(c){throw s!==0&&a._OrtReleaseRunOptions(s),n.forEach(d=>a._free(d)),c}}}),ya,ga,wa,Kt,Qt,va,lo,lu=W(()=>{lt(),xn(),ya=r=>{switch(r){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"layout":return 3;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${r}`)}},ga=r=>{switch(r){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${r}`)}},wa=r=>{r.extra||(r.extra={}),r.extra.session||(r.extra.session={});let a=r.extra.session;a.use_ort_model_bytes_directly||(a.use_ort_model_bytes_directly="1"),r.executionProviders&&r.executionProviders.some(s=>(typeof s=="string"?s:s.name)==="webgpu")&&(r.enableMemPattern=!1)},Kt=(r,a,s,n)=>{let u=be(a,n),c=be(s,n);Z()._OrtAddSessionConfigEntry(r,u,c)!==0&&H(`Can't set a session config entry: ${a} - ${s}.`)},Qt=(r,a,s,n)=>{let u=be(a,n),c=be(s,n);r.push([u,c])},va=async(r,a,s)=>{for(let n of a){let u=typeof n=="string"?n:n.name,c=[];switch(u){case"webnn":if(u="WEBNN",typeof n!="string"){let v=n?.deviceType;v&&Kt(r,"deviceType",v,s)}break;case"webgpu":{u="WebGPU";let v;if(typeof n!="string"){let T=n;if(T.device)if(typeof GPUDevice<"u"&&T.device instanceof GPUDevice)v=T.device;else throw new Error("Invalid GPU device set in WebGPU EP options.")}let C=Z().webgpuRegisterDevice(v);if(C){let[T,I,O]=C;Qt(c,"deviceId",T.toString(),s),Qt(c,"webgpuInstance",I.toString(),s),Qt(c,"webgpuDevice",O.toString(),s)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${u}`)}let d=be(u,s),p=c.length,m=0,g=0;if(p>0){m=Z()._malloc(p*Z().PTR_SIZE),s.push(m),g=Z()._malloc(p*Z().PTR_SIZE),s.push(g);for(let v=0;v<p;v++)Z().setValue(m+v*Z().PTR_SIZE,c[v][0],"*"),Z().setValue(g+v*Z().PTR_SIZE,c[v][1],"*")}await Z()._OrtAppendExecutionProvider(r,d,m,g,p)!==0&&H(`Can't append execution provider: ${u}.`)}},lo=async r=>{let a=Z(),s=0,n=[],u=r||{};wa(u);try{let c=ya(u.graphOptimizationLevel??"all"),d=ga(u.executionMode??"sequential"),p=typeof u.logId=="string"?be(u.logId,n):0,m=u.logSeverityLevel??2;if(!Number.isInteger(m)||m<0||m>4)throw new Error(`log severity level is not valid: ${m}`);let g=u.logVerbosityLevel??0;if(!Number.isInteger(g)||g<0||g>4)throw new Error(`log verbosity level is not valid: ${g}`);let v=typeof u.optimizedModelFilePath=="string"?be(u.optimizedModelFilePath,n):0;if(s=a._OrtCreateSessionOptions(c,!!u.enableCpuMemArena,!!u.enableMemPattern,d,!!u.enableProfiling,0,p,m,g,v),s===0&&H("Can't create session options."),u.executionProviders&&await va(s,u.executionProviders,n),u.enableGraphCapture!==void 0){if(typeof u.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${u.enableGraphCapture}`);Kt(s,"enableGraphCapture",u.enableGraphCapture.toString(),n)}if(u.freeDimensionOverrides)for(let[C,T]of Object.entries(u.freeDimensionOverrides)){if(typeof C!="string")throw new Error(`free dimension override name must be a string: ${C}`);if(typeof T!="number"||!Number.isInteger(T)||T<0)throw new Error(`free dimension override value must be a non-negative integer: ${T}`);let I=be(C,n);a._OrtAddFreeDimensionOverride(s,I,T)!==0&&H(`Can't set a free dimension override: ${C} - ${T}.`)}return u.extra!==void 0&&or(u.extra,"",new WeakSet,(C,T)=>{Kt(s,C,T,n)}),[s,n]}catch(c){throw s!==0&&a._OrtReleaseSessionOptions(s)!==0&&H("Can't release session options."),n.forEach(d=>a._free(d)),c}}}),it,ir,mt,Lt,sr,En,In,pn,bt=W(()=>{it=r=>{switch(r){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${r}`)}},ir=r=>{switch(r){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${r}`)}},mt=(r,a)=>{let s=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][r],n=typeof a=="number"?a:a.reduce((u,c)=>u*c,1);return s>0?Math.ceil(n*s):void 0},Lt=r=>{switch(r){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${r}`)}},sr=r=>{switch(r){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${r}`)}},En=r=>r==="float32"||r==="float16"||r==="int32"||r==="int64"||r==="uint32"||r==="uint8"||r==="bool"||r==="uint4"||r==="int4",In=r=>r==="float32"||r==="float16"||r==="int32"||r==="int64"||r==="uint32"||r==="uint64"||r==="int8"||r==="uint8"||r==="bool"||r==="uint4"||r==="int4",pn=r=>{switch(r){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${r}`)}}}),On,uo=W(()=>{Cn(),On=async r=>{if(typeof r=="string"){let a=await fetch(r);if(!a.ok)throw new Error(`failed to load external data file: ${r}`);let s=a.headers.get("Content-Length"),n=s?parseInt(s,10):0;if(n<1073741824)return new Uint8Array(await a.arrayBuffer());{if(!a.body)throw new Error(`failed to load external data file: ${r}, no response body.`);let u=a.body.getReader(),c;try{c=new ArrayBuffer(n)}catch(p){if(p instanceof RangeError){let m=Math.ceil(n/65536);c=new WebAssembly.Memory({initial:m,maximum:m}).buffer}else throw p}let d=0;for(;;){let{done:p,value:m}=await u.read();if(p)break;let g=m.byteLength;new Uint8Array(c,d,g).set(m),d+=g}return new Uint8Array(c,0,n)}}else return r instanceof Blob?new Uint8Array(await r.arrayBuffer()):r instanceof Uint8Array?r:new Uint8Array(r)}}),fo,uu=W(()=>{bt(),fo=(r,a)=>new(Lt(a))(r)}),ba,Ca,Ta,_a,co,xa,ce,po=W(()=>{bt(),ba=["V","I","W","E","F"],Ca=(r,a)=>{console.log(`[${ba[r]},${new Date().toISOString()}]${a}`)},co=(r,a)=>{Ta=r,_a=a},xa=(r,a)=>{let s=sr(r),n=sr(Ta);s>=n&&Ca(s,typeof a=="function"?a():a)},ce=(...r)=>{_a&&xa(...r)}}),Kr,hn,Qr,Ea,en,Ia,tn,rn,nn,Oa,ho,fu=W(()=>{bt(),po(),Kr=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),hn=(r,a)=>{if(a==="int32")return r;let s=Kr.get(a);if(!s)throw new Error(`WebNN backend does not support data type: ${a}`);let n=s/8;if(r.byteLength%n!==0)throw new Error(`Invalid Uint8Array length - must be a multiple of ${n}.`);let u=r.byteLength/n,c=new(Lt(a))(r.buffer,r.byteOffset,u);switch(a){case"int64":case"uint64":{let d=new Int32Array(u);for(let p=0;p<u;p++){let m=c[p];if(m>2147483647n||m<-2147483648n)throw new Error("Can not convert int64 data to int32 - value out of range.");d[p]=Number(m)}return new Uint8Array(d.buffer)}case"int8":case"uint8":case"uint32":{if(a==="uint32"&&c.some(p=>p>2147483647))throw new Error("Can not convert uint32 data to int32 - value out of range.");let d=Int32Array.from(c,Number);return new Uint8Array(d.buffer)}default:throw new Error(`Unsupported data conversion from ${a} to 'int32'`)}},Qr=(r,a)=>{if(a==="int32")return r;if(r.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (int32).");let s=r.byteLength/4,n=new Int32Array(r.buffer,r.byteOffset,s);switch(a){case"int64":{let u=BigInt64Array.from(n,BigInt);return new Uint8Array(u.buffer)}case"uint64":{if(n.some(c=>c<0))throw new Error("Can not convert int32 data to uin64 - negative value found.");let u=BigUint64Array.from(n,BigInt);return new Uint8Array(u.buffer)}case"int8":{if(n.some(c=>c<-128||c>127))throw new Error("Can not convert int32 data to int8 - value out of range.");let u=Int8Array.from(n,Number);return new Uint8Array(u.buffer)}case"uint8":{if(n.some(u=>u<0||u>255))throw new Error("Can not convert int32 data to uint8 - value out of range.");return Uint8Array.from(n,Number)}case"uint32":{if(n.some(c=>c<0))throw new Error("Can not convert int32 data to uint32 - negative value found.");let u=Uint32Array.from(n,Number);return new Uint8Array(u.buffer)}default:throw new Error(`Unsupported data conversion from 'int32' to ${a}`)}},Ea=1,en=()=>Ea++,Ia=new Map([["int8","int32"],["uint8","int32"],["uint32","int32"],["int64","int32"]]),tn=(r,a)=>{let s=Kr.get(r);if(!s)throw new Error(`WebNN backend does not support data type: ${r}`);return a.length>0?Math.ceil(a.reduce((n,u)=>n*u)*s/8):0},rn=class{constructor(r){this.isDataConverted=!1;let{sessionId:a,context:s,tensor:n,dataType:u,shape:c,fallbackDataType:d}=r;this.sessionId=a,this.mlContext=s,this.mlTensor=n,this.dataType=u,this.tensorShape=c,this.fallbackDataType=d}get tensor(){return this.mlTensor}get type(){return this.dataType}get fallbackType(){return this.fallbackDataType}get shape(){return this.tensorShape}get byteLength(){return tn(this.dataType,this.tensorShape)}destroy(){ce("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(r){this.mlContext.writeTensor(this.mlTensor,r)}async read(r){if(this.fallbackDataType){let a=await this.mlContext.readTensor(this.mlTensor),s=Qr(new Uint8Array(a),this.dataType);if(r){(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)).set(s);return}else return s.buffer}else return r?this.mlContext.readTensor(this.mlTensor,r):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(r,a,s){return this.mlContext===r&&this.dataType===a&&this.tensorShape.length===s.length&&this.tensorShape.every((n,u)=>n===s[u])}setIsDataConverted(r){this.isDataConverted=r}},nn=class{constructor(r,a){this.tensorManager=r,this.wrapper=a}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(r,a,s,n){let u=this.tensorManager.getMLContext(r),c;if(!u.opSupportLimits().input.dataTypes.includes(a)){if(c=Ia.get(a),!c||!u.opSupportLimits().input.dataTypes.includes(c))throw new Error(`WebNN backend does not support data type: ${a}`);ce("verbose",()=>`[WebNN] TensorIdTracker.ensureTensor: fallback dataType from ${a} to ${c}`)}if(this.wrapper){if(this.wrapper.canReuseTensor(u,a,s))return this.wrapper.tensor;if(n){if(this.wrapper.byteLength!==tn(a,s))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let d=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(r,a,s,d,!0,!0,c),n&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(r){let a=r;if(this.wrapper){if(this.wrapper.fallbackType)if(this.wrapper.fallbackType==="int32")a=hn(r,this.wrapper.type),this.wrapper.setIsDataConverted(!0);else throw new Error(`Unsupported fallback data type: ${this.wrapper.fallbackType}`);if(r.byteLength===this.wrapper.byteLength){this.wrapper.write(a);return}else ce("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor()}this.activeUpload?this.activeUpload.set(a):this.activeUpload=new Uint8Array(a)}async download(r){if(this.activeUpload){let a=this.wrapper?.isDataConverted?Qr(this.activeUpload,this.wrapper?.type):this.activeUpload;if(r){r instanceof ArrayBuffer?new Uint8Array(r).set(a):new Uint8Array(r.buffer,r.byteOffset,r.byteLength).set(a);return}else return a.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return r?this.wrapper.read(r):this.wrapper.read()}},Oa=class{constructor(r){this.backend=r,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(r){let a=this.backend.getMLContext(r);if(!a)throw new Error("MLContext not found for session.");return a}reserveTensorId(){let r=en();return this.tensorTrackersById.set(r,new nn(this)),r}releaseTensorId(r){let a=this.tensorTrackersById.get(r);a&&(this.tensorTrackersById.delete(r),a.tensorWrapper&&this.releaseTensor(a.tensorWrapper))}async ensureTensor(r,a,s,n,u){ce("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${a}, dataType: ${s}, shape: ${n}, copyOld: ${u}}`);let c=this.tensorTrackersById.get(a);if(!c)throw new Error("Tensor not found.");return c.ensureTensor(r,s,n,u)}upload(r,a){let s=this.tensorTrackersById.get(r);if(!s)throw new Error("Tensor not found.");s.upload(a)}async download(r,a){ce("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${r}, dstBuffer: ${a?.byteLength}}`);let s=this.tensorTrackersById.get(r);if(!s)throw new Error("Tensor not found.");return s.download(a)}releaseTensorsForSession(r){for(let a of this.freeTensors)a.sessionId===r&&a.destroy();this.freeTensors=this.freeTensors.filter(a=>a.sessionId!==r)}registerTensor(r,a,s,n){let u=this.getMLContext(r),c=en(),d=new rn({sessionId:r,context:u,tensor:a,dataType:s,shape:n});return this.tensorTrackersById.set(c,new nn(this,d)),this.externalTensors.add(d),c}async getCachedTensor(r,a,s,n,u,c,d){let p=this.getMLContext(r);for(let[g,v]of this.freeTensors.entries())if(v.canReuseTensor(p,a,s)){ce("verbose",()=>`[WebNN] Reusing tensor {dataType: ${a}, ${d?`fallbackDataType: ${d},`:""} shape: ${s}`);let C=this.freeTensors.splice(g,1)[0];return C.sessionId=r,C}ce("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${a}, ${d?`fallbackDataType: ${d},`:""} shape: ${s}}`);let m=await p.createTensor({dataType:d??a,shape:s,dimensions:s,usage:n,writable:u,readable:c});return new rn({sessionId:r,context:p,tensor:m,dataType:a,shape:s,fallbackDataType:d})}releaseTensor(r){this.externalTensors.has(r)&&this.externalTensors.delete(r),this.freeTensors.push(r)}},ho=(...r)=>new Oa(...r)}),mo={};jt(mo,{WebNNBackend:()=>yo});var St,Aa,yo,cu=W(()=>{bt(),lt(),uu(),fu(),po(),St=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Aa=(r,a)=>{if(r===a)return!0;if(r===void 0||a===void 0)return!1;let s=Object.keys(r).sort(),n=Object.keys(a).sort();return s.length===n.length&&s.every((u,c)=>u===n[c]&&r[u]===a[u])},yo=class{constructor(r){this.tensorManager=ho(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.sessionGraphOutputs=new Map,this.temporaryGraphInputs=[],this.temporaryGraphOutputs=[],this.temporarySessionTensorIds=new Map,co(r.logLevel,!!r.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(r){ce("verbose",()=>`[WebNN] onRunStart {sessionId: ${r}}`),this.activeSessionId=r}onRunEnd(r){ce("verbose",()=>`[WebNN] onRunEnd {sessionId: ${r}}`);let a=this.temporarySessionTensorIds.get(r);if(a){for(let s of a)ce("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${s}}`),this.tensorManager.releaseTensorId(s);this.temporarySessionTensorIds.delete(r),this.activeSessionId=void 0}}async createMLContext(r){if(r instanceof GPUDevice){let s=this.mlContextCache.findIndex(n=>n.gpuDevice===r);if(s!==-1)return this.mlContextCache[s].mlContext;{let n=await navigator.ml.createContext(r);return this.mlContextCache.push({gpuDevice:r,mlContext:n}),n}}else if(r===void 0){let s=this.mlContextCache.findIndex(n=>n.options===void 0&&n.gpuDevice===void 0);if(s!==-1)return this.mlContextCache[s].mlContext;{let n=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:n}),n}}let a=this.mlContextCache.findIndex(s=>Aa(s.options,r));if(a!==-1)return this.mlContextCache[a].mlContext;{let s=await navigator.ml.createContext(r);return this.mlContextCache.push({options:r,mlContext:s}),s}}registerMLContext(r,a){this.mlContextBySessionId.set(r,a);let s=this.sessionIdsByMLContext.get(a);s||(s=new Set,this.sessionIdsByMLContext.set(a,s)),s.add(r),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(r,this.temporaryGraphInputs),this.temporaryGraphInputs=[]),this.temporaryGraphOutputs.length>0&&(this.sessionGraphOutputs.set(r,this.temporaryGraphOutputs),this.temporaryGraphOutputs=[])}onReleaseSession(r){this.sessionGraphInputs.delete(r),this.sessionGraphOutputs.delete(r);let a=this.mlContextBySessionId.get(r);if(!a)return;this.tensorManager.releaseTensorsForSession(r),this.mlContextBySessionId.delete(r);let s=this.sessionIdsByMLContext.get(a);if(s.delete(r),s.size===0){this.sessionIdsByMLContext.delete(a);let n=this.mlContextCache.findIndex(u=>u.mlContext===a);n!==-1&&this.mlContextCache.splice(n,1)}}getMLContext(r){return this.mlContextBySessionId.get(r)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(r){ce("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${r}}`),this.tensorManager.releaseTensorId(r)}async ensureTensor(r,a,s,n,u){let c=St.get(s);if(!c)throw new Error(`Unsupported ONNX data type: ${s}`);return this.tensorManager.ensureTensor(r??this.currentSessionId,a,c,n,u)}async createTemporaryTensor(r,a,s){ce("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${a}, shape: ${s}}`);let n=St.get(a);if(!n)throw new Error(`Unsupported ONNX data type: ${a}`);let u=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(r,u,n,s,!1);let c=this.temporarySessionTensorIds.get(r);return c?c.push(u):this.temporarySessionTensorIds.set(r,[u]),u}uploadTensor(r,a){if(!Z().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");ce("verbose",()=>`[WebNN] uploadTensor {tensorId: ${r}, data: ${a.byteLength}}`),this.tensorManager.upload(r,a)}async downloadTensor(r,a){return this.tensorManager.download(r,a)}createMLTensorDownloader(r,a){return async()=>{let s=await this.tensorManager.download(r);return fo(s,a)}}registerMLTensor(r,a,s,n){let u=St.get(s);if(!u)throw new Error(`Unsupported ONNX data type: ${s}`);let c=this.tensorManager.registerTensor(r,a,u,n);return ce("verbose",()=>`[WebNN] registerMLTensor {tensor: ${a}, dataType: ${u}, dimensions: ${n}} -> {tensorId: ${c}}`),c}registerMLConstant(r,a,s,n,u,c,d=!1){if(!c)throw new Error("External mounted files are not available.");let p=r;r.startsWith("./")&&(p=r.substring(2));let m=c.get(p);if(!m)throw new Error(`File with name ${p} not found in preloaded files.`);if(a+s>m.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let g=m.slice(a,a+s).buffer,v;switch(u.dataType){case"float32":v=new Float32Array(g);break;case"float16":v=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(g):new Uint16Array(g);break;case"int32":v=new Int32Array(g);break;case"uint32":v=new Uint32Array(g);break;case"int64":if(d){let C=hn(new Uint8Array(g),"int64");v=new Int32Array(C.buffer),u.dataType="int32"}else v=new BigInt64Array(g);break;case"uint64":v=new BigUint64Array(g);break;case"int8":v=new Int8Array(g);break;case"int4":case"uint4":case"uint8":v=new Uint8Array(g);break;default:throw new Error(`Unsupported data type: ${u.dataType} in creating WebNN Constant from external data.`)}return ce("verbose",()=>`[WebNN] registerMLConstant {dataType: ${u.dataType}, shape: ${u.shape}}} ${d?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),n.constant(u,v)}registerGraphInput(r){this.temporaryGraphInputs.push(r)}registerGraphOutput(r){this.temporaryGraphOutputs.push(r)}isGraphInput(r,a){let s=this.sessionGraphInputs.get(r);return s?s.includes(a):!1}isGraphOutput(r,a){let s=this.sessionGraphOutputs.get(r);return s?s.includes(a):!1}isGraphInputOutputTypeSupported(r,a,s=!0){let n=this.mlContextBySessionId.get(r),u=St.get(it(a));return typeof u>"u"?!1:s?!!n?.opSupportLimits().input.dataTypes.includes(u):!!n?.opSupportLimits().output.dataTypes.includes(u)}flush(){}}}),Ra,An,Rn,Xe,Sa,an,lr,Sn,Pn,on,Mn,Un,Bn,go=W(()=>{st(),su(),lu(),bt(),lt(),xn(),uo(),Ra=(r,a)=>{Z()._OrtInit(r,a)!==0&&H("Can't initialize onnxruntime.")},An=async r=>{Ra(r.wasm.numThreads,sr(r.logLevel))},Rn=async(r,a)=>{Z().asyncInit?.();let s=r.webgpu.adapter;if(a==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");if(s){if(typeof s.limits!="object"||typeof s.features!="object"||typeof s.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let n=r.webgpu.powerPreference;if(n!==void 0&&n!=="low-power"&&n!=="high-performance")throw new Error(`Invalid powerPreference setting: "${n}"`);let u=r.webgpu.forceFallbackAdapter;if(u!==void 0&&typeof u!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${u}"`);if(s=await navigator.gpu.requestAdapter({powerPreference:n,forceFallbackAdapter:u}),!s)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}}if(a==="webnn"&&(typeof navigator>"u"||!navigator.ml))throw new Error("WebNN is not supported in current environment");if(a==="webgpu"&&Z().webgpuInit(n=>{r.webgpu.device=n}),a==="webnn"){let n=new(cu(),ar(mo)).WebNNBackend(r);Z().webnnInit([n,()=>n.reserveTensorId(),u=>n.releaseTensorId(u),async(u,c,d,p,m)=>n.ensureTensor(u,c,d,p,m),(u,c)=>{n.uploadTensor(u,c)},async(u,c)=>n.downloadTensor(u,c),(u,c)=>n.registerMLContext(u,c),!!r.trace])}},Xe=new Map,Sa=r=>{let a=Z(),s=a.stackSave();try{let n=a.PTR_SIZE,u=a.stackAlloc(2*n);a._OrtGetInputOutputCount(r,u,u+n)!==0&&H("Can't get session input/output count.");let c=n===4?"i32":"i64";return[Number(a.getValue(u,c)),Number(a.getValue(u+n,c))]}finally{a.stackRestore(s)}},an=(r,a)=>{let s=Z(),n=s.stackSave(),u=0;try{let c=s.PTR_SIZE,d=s.stackAlloc(2*c);s._OrtGetInputOutputMetadata(r,a,d,d+c)!==0&&H("Can't get session input/output metadata.");let p=Number(s.getValue(d,"*"));u=Number(s.getValue(d+c,"*"));let m=s.HEAP32[u/4];if(m===0)return[p,0];let g=s.HEAPU32[u/4+1],v=[];for(let C=0;C<g;C++){let T=Number(s.getValue(u+8+C*c,"*"));v.push(T!==0?s.UTF8ToString(T):Number(s.getValue(u+8+(C+g)*c,"*")))}return[p,m,v]}finally{s.stackRestore(n),u!==0&&s._OrtFree(u)}},lr=r=>{let a=Z(),s=a._malloc(r.byteLength);if(s===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${r.byteLength}.`);return a.HEAPU8.set(r,s),[s,r.byteLength]},Sn=async(r,a)=>{let s,n,u=Z();Array.isArray(r)?[s,n]=r:r.buffer===u.HEAPU8.buffer?[s,n]=[r.byteOffset,r.byteLength]:[s,n]=lr(r);let c=0,d=0,p=0,m=[],g=[],v=[];try{if([d,m]=await lo(a),a?.externalData&&u.mountExternalData){let L=[];for(let N of a.externalData){let te=typeof N=="string"?N:N.path;L.push(On(typeof N=="string"?N:N.data).then(le=>{u.mountExternalData(te,le)}))}await Promise.all(L)}for(let L of a?.executionProviders??[])if((typeof L=="string"?L:L.name)==="webnn"){if(u.shouldTransferToMLTensor=!1,typeof L!="string"){let N=L,te=N?.context,le=N?.gpuDevice,Y=N?.deviceType,ie=N?.powerPreference;te?u.currentContext=te:le?u.currentContext=await u.webnnCreateMLContext(le):u.currentContext=await u.webnnCreateMLContext({deviceType:Y,powerPreference:ie})}else u.currentContext=await u.webnnCreateMLContext();break}c=await u._OrtCreateSession(s,n,d),u.webgpuOnCreateSession?.(c),c===0&&H("Can't create a session."),u.jsepOnCreateSession?.(),u.currentContext&&(u.webnnRegisterMLContext(c,u.currentContext),u.currentContext=void 0,u.shouldTransferToMLTensor=!0);let[C,T]=Sa(c),I=!!a?.enableGraphCapture,O=[],$=[],S=[],A=[],P=[];for(let L=0;L<C;L++){let[N,te,le]=an(c,L);N===0&&H("Can't get an input name."),g.push(N);let Y=u.UTF8ToString(N);O.push(Y),S.push(te===0?{name:Y,isTensor:!1}:{name:Y,isTensor:!0,type:ir(te),shape:le})}for(let L=0;L<T;L++){let[N,te,le]=an(c,L+C);N===0&&H("Can't get an output name."),v.push(N);let Y=u.UTF8ToString(N);$.push(Y),A.push(te===0?{name:Y,isTensor:!1}:{name:Y,isTensor:!0,type:ir(te),shape:le});{if(I&&a?.preferredOutputLocation===void 0){P.push("gpu-buffer");continue}let ie=typeof a?.preferredOutputLocation=="string"?a.preferredOutputLocation:a?.preferredOutputLocation?.[Y]??"cpu",re=u.webnnIsGraphOutput;if(ie==="cpu"&&re&&re(c,Y)){P.push("ml-tensor-cpu-output");continue}if(ie!=="cpu"&&ie!=="cpu-pinned"&&ie!=="gpu-buffer"&&ie!=="ml-tensor")throw new Error(`Not supported preferred output location: ${ie}.`);if(I&&ie!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${ie}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);P.push(ie)}}let D=null;return P.some(L=>L==="gpu-buffer"||L==="ml-tensor"||L==="ml-tensor-cpu-output")&&(p=u._OrtCreateBinding(c),p===0&&H("Can't create IO binding."),D={handle:p,outputPreferredLocations:P,outputPreferredLocationsEncoded:P.map(L=>L==="ml-tensor-cpu-output"?"ml-tensor":L).map(L=>pn(L))}),Xe.set(c,[c,g,v,D,I,!1]),[c,O,$,S,A]}catch(C){throw g.forEach(T=>u._OrtFree(T)),v.forEach(T=>u._OrtFree(T)),p!==0&&u._OrtReleaseBinding(p)!==0&&H("Can't release IO binding."),c!==0&&u._OrtReleaseSession(c)!==0&&H("Can't release session."),C}finally{u._free(s),d!==0&&u._OrtReleaseSessionOptions(d)!==0&&H("Can't release session options."),m.forEach(C=>u._free(C)),u.unmountExternalData?.()}},Pn=r=>{let a=Z(),s=Xe.get(r);if(!s)throw new Error(`cannot release session. invalid session id: ${r}`);let[n,u,c,d,p]=s;d&&(p&&a._OrtClearBoundOutputs(d.handle)!==0&&H("Can't clear bound outputs."),a._OrtReleaseBinding(d.handle)!==0&&H("Can't release IO binding.")),a.jsepOnReleaseSession?.(r),a.webnnOnReleaseSession?.(r),a.webgpuOnReleaseSession?.(r),u.forEach(m=>a._OrtFree(m)),c.forEach(m=>a._OrtFree(m)),a._OrtReleaseSession(n)!==0&&H("Can't release session."),Xe.delete(r)},on=async(r,a,s,n,u,c,d=!1)=>{if(!r){a.push(0);return}let p=Z(),m=p.PTR_SIZE,g=r[0],v=r[1],C=r[3],T=C,I,O;if(g==="string"&&(C==="gpu-buffer"||C==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(d&&C!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${c} when enableGraphCapture is true.`);if(C==="gpu-buffer"){let A=r[2].gpuBuffer;O=mt(it(g),v);{let P=p.webgpuRegisterBuffer;if(!P)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');I=P(A,n)}}else if(C==="ml-tensor"){let A=r[2].mlTensor;O=mt(it(g),v);let P=p.webnnRegisterMLTensor;if(!P)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');I=P(n,A,it(g),v)}else{let A=r[2];if(Array.isArray(A)){O=m*A.length,I=p._malloc(O),s.push(I);for(let P=0;P<A.length;P++){if(typeof A[P]!="string")throw new TypeError(`tensor data at index ${P} is not a string`);p.setValue(I+P*m,be(A[P],s),"*")}}else{let P=p.webnnIsGraphInput,D=p.webnnIsGraphOutput;if(g!=="string"&&P&&D){let L=p.UTF8ToString(u);if(P(n,L)||D(n,L)){let N=it(g);O=mt(N,v),T="ml-tensor";let te=p.webnnCreateTemporaryTensor,le=p.webnnUploadTensor;if(!te||!le)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let Y=await te(n,N,v);le(Y,new Uint8Array(A.buffer,A.byteOffset,A.byteLength)),I=Y}else O=A.byteLength,I=p._malloc(O),s.push(I),p.HEAPU8.set(new Uint8Array(A.buffer,A.byteOffset,O),I)}else O=A.byteLength,I=p._malloc(O),s.push(I),p.HEAPU8.set(new Uint8Array(A.buffer,A.byteOffset,O),I)}}let $=p.stackSave(),S=p.stackAlloc(4*v.length);try{v.forEach((P,D)=>p.setValue(S+D*m,P,m===4?"i32":"i64"));let A=p._OrtCreateTensor(it(g),I,O,S,v.length,pn(T));A===0&&H(`Can't create tensor for input/output. session=${n}, index=${c}.`),a.push(A)}finally{p.stackRestore($)}},Mn=async(r,a,s,n,u,c)=>{let d=Z(),p=d.PTR_SIZE,m=Xe.get(r);if(!m)throw new Error(`cannot run inference. invalid session id: ${r}`);let g=m[0],v=m[1],C=m[2],T=m[3],I=m[4],O=m[5],$=a.length,S=n.length,A=0,P=[],D=[],L=[],N=[],te=d.stackSave(),le=d.stackAlloc($*p),Y=d.stackAlloc($*p),ie=d.stackAlloc(S*p),re=d.stackAlloc(S*p);try{[A,P]=so(c),at("wasm prepareInputOutputTensor");for(let j=0;j<$;j++)await on(s[j],D,N,r,v[a[j]],a[j],I);for(let j=0;j<S;j++)await on(u[j],L,N,r,C[n[j]],$+n[j],I);ot("wasm prepareInputOutputTensor");for(let j=0;j<$;j++)d.setValue(le+j*p,D[j],"*"),d.setValue(Y+j*p,v[a[j]],"*");for(let j=0;j<S;j++)d.setValue(ie+j*p,L[j],"*"),d.setValue(re+j*p,C[n[j]],"*");if(T&&!O){let{handle:j,outputPreferredLocations:ne,outputPreferredLocationsEncoded:$e}=T;if(v.length!==$)throw new Error(`input count from feeds (${$}) is expected to be always equal to model's input count (${v.length}).`);at("wasm bindInputsOutputs");for(let k=0;k<$;k++){let ue=a[k];await d._OrtBindInput(j,v[ue],D[k])!==0&&H(`Can't bind input[${k}] for session=${r}.`)}for(let k=0;k<S;k++){let ue=n[k];u[k]?.[3]?d._OrtBindOutput(j,C[ue],L[k],0)!==0&&H(`Can't bind pre-allocated output[${k}] for session=${r}.`):d._OrtBindOutput(j,C[ue],0,$e[ue])!==0&&H(`Can't bind output[${k}] to ${ne[k]} for session=${r}.`)}ot("wasm bindInputsOutputs"),Xe.set(r,[g,v,C,T,I,!0])}d.jsepOnRunStart?.(g),d.webnnOnRunStart?.(g);let J;T?J=await d._OrtRunWithBinding(g,T.handle,S,ie,A):J=await d._OrtRun(g,Y,le,$,re,S,ie,A),J!==0&&H("failed to call OrtRun().");let V=[],ye=[];at("wasm ProcessOutputTensor");for(let j=0;j<S;j++){let ne=Number(d.getValue(ie+j*p,"*"));if(ne===L[j]){V.push(u[j]);continue}let $e=d.stackSave(),k=d.stackAlloc(4*p),ue=!1,X,K=0;try{d._OrtGetTensorData(ne,k,k+p,k+2*p,k+3*p)!==0&&H(`Can't access output tensor data on index ${j}.`);let ae=p===4?"i32":"i64",Re=Number(d.getValue(k,ae));K=d.getValue(k+p,"*");let ut=d.getValue(k+p*2,"*"),M=Number(d.getValue(k+p*3,ae)),E=[];for(let oe=0;oe<M;oe++)E.push(Number(d.getValue(ut+oe*p,ae)));d._OrtFree(ut)!==0&&H("Can't free memory for tensor dims.");let Te=E.reduce((oe,G)=>oe*G,1);X=ir(Re);let ge=T?.outputPreferredLocations[n[j]];if(X==="string"){if(ge==="gpu-buffer"||ge==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let oe=[];for(let G=0;G<Te;G++){let _e=d.getValue(K+G*p,"*"),Ke=d.getValue(K+(G+1)*p,"*"),je=G===Te-1?void 0:Ke-_e;oe.push(d.UTF8ToString(_e,je))}V.push([X,E,oe,"cpu"])}else if(ge==="gpu-buffer"&&Te>0){let oe=d.webgpuGetBuffer;if(!oe)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let G=oe(K),_e=mt(Re,Te);if(_e===void 0||!En(X))throw new Error(`Unsupported data type: ${X}`);ue=!0;{d.webgpuRegisterBuffer(G,r,K);let Ke=d.webgpuCreateDownloader(G,_e,r);V.push([X,E,{gpuBuffer:G,download:async()=>{let je=await Ke();return new(Lt(X))(je)},dispose:()=>{d._OrtReleaseTensor(ne)!==0&&H("Can't release tensor.")}},"gpu-buffer"])}}else if(ge==="ml-tensor"&&Te>0){let oe=d.webnnEnsureTensor,G=d.webnnIsGraphInputOutputTypeSupported;if(!oe||!G)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(mt(Re,Te)===void 0||!In(X))throw new Error(`Unsupported data type: ${X}`);if(!G(r,X,!1))throw new Error(`preferredLocation "ml-tensor" for ${X} output is not supported by current WebNN Context.`);let _e=await oe(r,K,Re,E,!1);ue=!0,V.push([X,E,{mlTensor:_e,download:d.webnnCreateMLTensorDownloader(K,X),dispose:()=>{d.webnnReleaseTensorId(K),d._OrtReleaseTensor(ne)}},"ml-tensor"])}else if(ge==="ml-tensor-cpu-output"&&Te>0){let oe=d.webnnCreateMLTensorDownloader(K,X)(),G=V.length;ue=!0,ye.push((async()=>{let _e=[G,await oe];return d.webnnReleaseTensorId(K),d._OrtReleaseTensor(ne),_e})()),V.push([X,E,[],"cpu"])}else{let oe=Lt(X),G=new oe(Te);new Uint8Array(G.buffer,G.byteOffset,G.byteLength).set(d.HEAPU8.subarray(K,K+G.byteLength)),V.push([X,E,G,"cpu"])}}finally{d.stackRestore($e),X==="string"&&K&&d._free(K),ue||d._OrtReleaseTensor(ne)}}T&&!I&&(d._OrtClearBoundOutputs(T.handle)!==0&&H("Can't clear bound outputs."),Xe.set(r,[g,v,C,T,I,!1]));for(let[j,ne]of await Promise.all(ye))V[j][2]=ne;return ot("wasm ProcessOutputTensor"),V}finally{d.webnnOnRunEnd?.(g),d.stackRestore(te),s.forEach(J=>{J&&J[3]==="gpu-buffer"&&d.webgpuUnregisterBuffer(J[2].gpuBuffer)}),u.forEach(J=>{J&&J[3]==="gpu-buffer"&&d.webgpuUnregisterBuffer(J[2].gpuBuffer)}),D.forEach(J=>d._OrtReleaseTensor(J)),L.forEach(J=>d._OrtReleaseTensor(J)),N.forEach(J=>d._free(J)),A!==0&&d._OrtReleaseRunOptions(A),P.forEach(J=>d._free(J))}},Un=r=>{let a=Z(),s=Xe.get(r);if(!s)throw new Error("invalid session id");let n=s[0],u=a._OrtEndProfiling(n);u===0&&H("Can't get an profile file name."),a._OrtFree(u)},Bn=r=>{let a=[];for(let s of r){let n=s[2];!Array.isArray(n)&&"buffer"in n&&a.push(n.buffer)}return a}}),Ye,Oe,ht,Pt,Mt,er,sn,tr,tt,rt,Pa,wo,vo,bo,Co,To,_o,xo,Eo=W(()=>{st(),go(),lt(),Tn(),Ye=()=>!!ee.wasm.proxy&&typeof document<"u",ht=!1,Pt=!1,Mt=!1,tr=new Map,tt=(r,a)=>{let s=tr.get(r);s?s.push(a):tr.set(r,[a])},rt=()=>{if(ht||!Pt||Mt||!Oe)throw new Error("worker not ready")},Pa=r=>{switch(r.data.type){case"init-wasm":ht=!1,r.data.err?(Mt=!0,sn[1](r.data.err)):(Pt=!0,sn[0]()),er&&(URL.revokeObjectURL(er),er=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let a=tr.get(r.data.type);r.data.err?a.shift()[1](r.data.err):a.shift()[0](r.data.out);break}}},wo=async()=>{if(!Pt){if(ht)throw new Error("multiple calls to 'initWasm()' detected.");if(Mt)throw new Error("previous call to 'initWasm()' failed.");if(ht=!0,Ye())return new Promise((r,a)=>{Oe?.terminate(),ao().then(([s,n])=>{try{Oe=n,Oe.onerror=c=>a(c),Oe.onmessage=Pa,sn=[r,a];let u={type:"init-wasm",in:ee};!u.in.wasm.wasmPaths&&(s||dn)&&(u.in.wasm.wasmPaths={wasm:new URL("/assets/ort-wasm-simd-threaded.asyncify-BJtBjfiH.wasm",import.meta.url).href}),Oe.postMessage(u),er=s}catch(u){a(u)}},a)});try{await _n(ee.wasm),await An(ee),Pt=!0}catch(r){throw Mt=!0,r}finally{ht=!1}}},vo=async r=>{if(Ye())return rt(),new Promise((a,s)=>{tt("init-ep",[a,s]);let n={type:"init-ep",in:{epName:r,env:ee}};Oe.postMessage(n)});await Rn(ee,r)},bo=async r=>Ye()?(rt(),new Promise((a,s)=>{tt("copy-from",[a,s]);let n={type:"copy-from",in:{buffer:r}};Oe.postMessage(n,[r.buffer])})):lr(r),Co=async(r,a)=>{if(Ye()){if(a?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return rt(),new Promise((s,n)=>{tt("create",[s,n]);let u={type:"create",in:{model:r,options:{...a}}},c=[];r instanceof Uint8Array&&c.push(r.buffer),Oe.postMessage(u,c)})}else return Sn(r,a)},To=async r=>{if(Ye())return rt(),new Promise((a,s)=>{tt("release",[a,s]);let n={type:"release",in:r};Oe.postMessage(n)});Pn(r)},_o=async(r,a,s,n,u,c)=>{if(Ye()){if(s.some(d=>d[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(u.some(d=>d))throw new Error("pre-allocated output tensor is not supported for proxy.");return rt(),new Promise((d,p)=>{tt("run",[d,p]);let m=s,g={type:"run",in:{sessionId:r,inputIndices:a,inputs:m,outputIndices:n,options:c}};Oe.postMessage(g,Bn(m))})}else return Mn(r,a,s,n,u,c)},xo=async r=>{if(Ye())return rt(),new Promise((a,s)=>{tt("end-profiling",[a,s]);let n={type:"end-profiling",in:r};Oe.postMessage(n)});Un(r)}}),ln,Ma,Io,du=W(()=>{st(),Eo(),bt(),Cn(),uo(),ln=(r,a)=>{switch(r.location){case"cpu":return[r.type,r.dims,r.data,"cpu"];case"gpu-buffer":return[r.type,r.dims,{gpuBuffer:r.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[r.type,r.dims,{mlTensor:r.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${r.location} for ${a()}`)}},Ma=r=>{switch(r[3]){case"cpu":return new Ae(r[0],r[2],r[1]);case"gpu-buffer":{let a=r[0];if(!En(a))throw new Error(`not supported data type: ${a} for deserializing GPU tensor`);let{gpuBuffer:s,download:n,dispose:u}=r[2];return Ae.fromGpuBuffer(s,{dataType:a,dims:r[1],download:n,dispose:u})}case"ml-tensor":{let a=r[0];if(!In(a))throw new Error(`not supported data type: ${a} for deserializing MLTensor tensor`);let{mlTensor:s,download:n,dispose:u}=r[2];return Ae.fromMLTensor(s,{dataType:a,dims:r[1],download:n,dispose:u})}default:throw new Error(`invalid data location: ${r[3]}`)}},Io=class{async fetchModelAndCopyToWasmMemory(r){return bo(await On(r))}async loadModel(r,a){wt();let s;typeof r=="string"?s=await this.fetchModelAndCopyToWasmMemory(r):s=r,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await Co(s,a),vt()}async dispose(){return To(this.sessionId)}async run(r,a,s){wt();let n=[],u=[];Object.entries(r).forEach(C=>{let T=C[0],I=C[1],O=this.inputNames.indexOf(T);if(O===-1)throw new Error(`invalid input '${T}'`);n.push(I),u.push(O)});let c=[],d=[];Object.entries(a).forEach(C=>{let T=C[0],I=C[1],O=this.outputNames.indexOf(T);if(O===-1)throw new Error(`invalid output '${T}'`);c.push(I),d.push(O)});let p=n.map((C,T)=>ln(C,()=>`input "${this.inputNames[u[T]]}"`)),m=c.map((C,T)=>C?ln(C,()=>`output "${this.outputNames[d[T]]}"`):null),g=await _o(this.sessionId,u,p,d,m,s),v={};for(let C=0;C<g.length;C++)v[this.outputNames[d[C]]]=c[C]??Ma(g[C]);return vt(),v}startProfiling(){}endProfiling(){xo(this.sessionId)}}}),Oo={};jt(Oo,{OnnxruntimeWebAssemblyBackend:()=>yn,initializeFlags:()=>mn,wasmBackend:()=>Ao});var mn,yn,Ao,pu=W(()=>{st(),Eo(),du(),mn=()=>{(typeof ee.wasm.initTimeout!="number"||ee.wasm.initTimeout<0)&&(ee.wasm.initTimeout=0);let r=ee.wasm.simd;if(typeof r!="boolean"&&r!==void 0&&r!=="fixed"&&r!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${r}". Reset it to \`false\` and ignore SIMD feature checking.`),ee.wasm.simd=!1),typeof ee.wasm.proxy!="boolean"&&(ee.wasm.proxy=!1),typeof ee.wasm.trace!="boolean"&&(ee.wasm.trace=!1),typeof ee.wasm.numThreads!="number"||!Number.isInteger(ee.wasm.numThreads)||ee.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)ee.wasm.numThreads=1;else{let a=typeof navigator>"u"?Fl("node:os").cpus().length:navigator.hardwareConcurrency;ee.wasm.numThreads=Math.min(4,Math.ceil((a||1)/2))}},yn=class{async init(r){mn(),await wo(),await vo(r)}async createInferenceSessionHandler(r,a){let s=new Io;return await s.loadModel(r,a),s}},Ao=new yn});st();st();st();var hu="1.23.2";{let r=(pu(),ar(Oo)).wasmBackend;yt("webgpu",r,5),yt("webnn",r,5),yt("cpu",r,10),yt("wasm",r,10)}Object.defineProperty(ee.versions,"web",{value:hu,enumerable:!0});let Ut=null;const mu=async()=>{if(Ut)return Ut;const r="huggingface.co",a="hf-mirror.com",s="/webml/models-moved/resolve/main/01.onnx",n=async d=>{const p=new AbortController,m=setTimeout(()=>p.abort(),3e3);try{const g=await fetch(`https://${d}${s}`,{method:"HEAD",signal:p.signal,cache:"no-store"});return clearTimeout(m),g.ok}catch(g){return console.log(`Error reaching ${d}:`,g),clearTimeout(m),!1}};return await n(r)?(Ut=r,r):await n(a)?(console.log(`Hugging Face main domain unreachable. Switching to mirror: ${a}`),Ut=a,a):(Ut=r,r)},q={status:document.getElementById("status"),backendDisplay:document.getElementById("backend-display"),fileInput:document.getElementById("upload"),resultContainer:document.getElementById("result-container"),canvasOverlay:document.getElementById("canvas-overlay"),imagePreview:document.getElementById("image-preview"),detCompilation:document.getElementById("detCom"),detInference:document.getElementById("detInf"),recCompilation:document.getElementById("recCom"),recInference:document.getElementById("recInf"),backend:document.getElementById("backend"),model:document.getElementById("model"),exampleLink:document.getElementById("example-link"),modelRadios:document.querySelectorAll('input[name="model-version"]')};function Me(r){q.status&&(q.status.textContent=r)}function yu(r){q.backendDisplay&&(q.backendDisplay.textContent=r),q.backend&&(q.backend.textContent=`  ${r}`)}function gu(r){q.model&&(r==="1"?q.model.textContent="PP-OCRv5":q.model.textContent="PP-OCRv4")}function wu(r){q.imagePreview&&(q.imagePreview.src=r,q.imagePreview.style.display="block")}function vu(){q.resultContainer&&(q.resultContainer.innerHTML="")}function bu(r,a){if(!q.resultContainer)return;const s=document.createElement("p");s.textContent=`[${a.toFixed(2)}] ${r}`,q.resultContainer.appendChild(s)}function ur(r,a){r==="detCom"&&q.detCompilation&&(q.detCompilation.textContent=a.toFixed(2)),r==="detInf"&&q.detInference&&(q.detInference.textContent=a.toFixed(2)),r==="recCom"&&q.recCompilation&&(q.recCompilation.textContent=a.toFixed(2)),r==="recInf"&&q.recInference&&(q.recInference.textContent=a.toFixed(2))}function Cu(){const r=new URLSearchParams(window.location.search),a=r.has("model");if(!a){const s=new URL(window.location.href);return s.searchParams.set("model","1"),s.searchParams.has("device")||s.searchParams.set("device","wasm"),window.location.replace(s.toString()),null}return{modelVersion:r.get("model")||"0",device:r.get("device")||"wasm",image:r.get("image"),hasModelParam:a,hasDeviceParam:r.has("device")}}function Tu(r){const{onUpload:a,onExampleClick:s,onModelChange:n,modelVersion:u}=r;q.fileInput&&q.fileInput.addEventListener("change",async c=>{c.target.files.length>0&&await a(c.target.files[0])}),q.exampleLink&&q.exampleLink.addEventListener("click",async c=>{c.preventDefault(),await s()}),q.modelRadios.forEach(c=>{c.checked=c.value===u,c.addEventListener("change",d=>{n(d.target.value)})}),gu(u)}ee.wasm.wasmPaths="/onnxruntime-web-1-23-2-dists/";async function _u(r){return new Promise((a,s)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>a(n),n.onerror=s,r instanceof Blob?n.src=URL.createObjectURL(r):n.src=r})}function xu(r,a=960){const s=document.createElement("canvas");let n=r.width,u=r.height;if(a&&Math.max(n,u)>a){const S=n>u?a/n:a/u;n=n*S,u=u*S}const c=Math.max(Math.ceil(n/32)*32,32),d=Math.max(Math.ceil(u/32)*32,32);s.width=c,s.height=d;const p=s.getContext("2d");p.drawImage(r,0,0,c,d);const m=p.getImageData(0,0,c,d),{data:g}=m,v=[.485,.456,.406],C=[.229,.224,.225],T=[],I=[],O=[];for(let S=0;S<g.length;S+=4)T.push((g[S]/255-v[0])/C[0]),I.push((g[S+1]/255-v[1])/C[1]),O.push((g[S+2]/255-v[2])/C[2]);return Float32Array.from([...T,...I,...O]),{tensor:new Ae("float32",Float32Array.from([...O,...I,...T]),[1,3,d,c]),width:c,height:d,originalWidth:r.width,originalHeight:r.height,imageData:m}}function Eu(r,a,s,n=.3){const u=r.data,c=new Uint8ClampedArray(a*s*4);for(let d=0;d<u.length;d++){const p=u[d]>n?255:0;c[d*4]=p,c[d*4+1]=p,c[d*4+2]=p,c[d*4+3]=255}return new ImageData(c,a,s)}function Iu(r,a){if(typeof cv>"u")return console.error("OpenCV not loaded"),[];const s=r.width,n=r.height,u=cv.matFromImageData(r);cv.cvtColor(u,u,cv.COLOR_RGBA2GRAY,0);const c=new cv.MatVector,d=new cv.Mat;cv.findContours(u,c,d,cv.RETR_LIST,cv.CHAIN_APPROX_SIMPLE);const p=[],m=3,g=document.createElement("canvas");g.width=a.width,g.height=a.height;const v=g.getContext("2d");v.drawImage(a,0,0);const C=v.getImageData(0,0,a.width,a.height),T=cv.matFromImageData(C),I=a.width/s,O=a.height/n;for(let $=0;$<c.size();$++){const S=c.get($),A=cv.minAreaRect(S);if(cv.RotatedRect.points(A),Math.min(A.size.width,A.size.height)<m)continue;const D=1.5,L=A.size.width,N=A.size.height,te=L*N,le=2*(L+N),Y=te*D/le,ie=new cv.Size(A.size.width+2*Y,A.size.height+2*Y),re=new cv.RotatedRect(A.center,ie,A.angle),V=cv.RotatedRect.points(re).map(K=>({x:K.x*I,y:K.y*O})),ye=Math.max(Math.hypot(V[0].x-V[1].x,V[0].y-V[1].y),Math.hypot(V[2].x-V[3].x,V[2].y-V[3].y)),j=Math.max(Math.hypot(V[1].x-V[2].x,V[1].y-V[2].y),Math.hypot(V[3].x-V[0].x,V[3].y-V[0].y)),ne=Ou(V),$e=cv.matFromArray(4,1,cv.CV_32FC2,[ne[0].x,ne[0].y,ne[1].x,ne[1].y,ne[2].x,ne[2].y,ne[3].x,ne[3].y]),k=cv.matFromArray(4,1,cv.CV_32FC2,[0,0,ye,0,ye,j,0,j]),ue=cv.getPerspectiveTransform($e,k),X=new cv.Mat;if(cv.warpPerspective(T,X,ue,new cv.Size(ye,j),cv.INTER_CUBIC,cv.BORDER_REPLICATE,new cv.Scalar),X.rows/X.cols>=1.5){const K=new cv.Mat;cv.rotate(X,K,cv.ROTATE_90_CLOCKWISE),X.delete(),p.push({mat:K,box:ne})}else p.push({mat:X,box:ne});$e.delete(),k.delete(),ue.delete()}return u.delete(),c.delete(),d.delete(),T.delete(),p.sort(($,S)=>$.box[0].y-S.box[0].y),p}function Ou(r){r.sort((p,m)=>p.x-m.x);const a=r.slice(0,2),s=r.slice(2,4);a.sort((p,m)=>p.y-m.y);const n=a[0],u=a[1];s.sort((p,m)=>p.y-m.y);const c=s[0],d=s[1];return[n,c,d,u]}function Au(r){const s=Math.ceil(r.cols*(48/r.rows)),n=new cv.Size(s,48),u=new cv.Mat;cv.resize(r,u,n,0,0,cv.INTER_LINEAR);const c=u.data,d=[],p=[],m=[];for(let v=0;v<c.length;v+=4)d.push((c[v]/255-.5)/.5),p.push((c[v+1]/255-.5)/.5),m.push((c[v+2]/255-.5)/.5);u.delete();const g=Float32Array.from([...m,...p,...d]);return new Ae("float32",g,[1,3,48,s])}function Ru(r,a){const s=r.dims;s[2],s[0];const n=s[1],u=s[2],c=r.data;let d="",p=0;const m=[],g=[];for(let I=0;I<n;I++){let O=-1/0,$=-1;const S=I*u;for(let A=0;A<u;A++){const P=c[S+A];P>O&&(O=P,$=A)}m.push($),g.push(O)}const v=[],C=[];for(let I=0;I<m.length;I++){const O=m[I];O!==0&&(I>0&&O===m[I-1]||(v.push(O),C.push(g[I])))}return d=v.map(I=>a[I-1]||"").join(""),C.length>0&&(p=C.reduce((I,O)=>I+O,0)/C.length),{text:d,meanProb:p}}function Su(r,a,s,n){r.width=a,r.height=s;const u=r.getContext("2d");u.clearRect(0,0,a,s),u.lineWidth=2,u.strokeStyle="red",n.forEach(c=>{const d=c.box;u.beginPath(),u.moveTo(d[0].x,d[0].y),u.lineTo(d[1].x,d[1].y),u.lineTo(d[2].x,d[2].y),u.lineTo(d[3].x,d[3].y),u.closePath(),u.stroke()})}ee.wasm.wasmPaths="/onnxruntime-web-1-23-2-dists/";const Ua=await mu(),fr=Cu();if(!fr)throw new Error("Redirecting...");const{modelVersion:Ro,device:me,image:Ba}=fr;let Je,$t;Ro==="1"?(Je=`https://${Ua}/webnn/PP-OCRv5-ONNX/resolve/main`,$t={det:`${Je}/ch_PP-OCRv5_det.onnx`,rec:`${Je}/ch_PP-OCRv5_rec.onnx`,dic:`${Je}/ch_PP-OCRv5_dict.txt`}):(Je=`https://${Ua}/webnn/PP-OCRv4-ONNX/resolve/main`,$t={det:`${Je}/ch_PP-OCRv4_det.onnx`,rec:`${Je}/ch_PP-OCRv4_rec.onnx`,dic:`${Je}/ch_PP-OCR_keys_v1.txt`});let rr=null,nr=null,gn=[],un=null,gt="";me==="wasm"?gt="Wasm":me==="webgpu"?gt="WebGPU":me.startsWith("webnn")?gt=`WebNN (${(me.includes("-")?me.split("-")[1]:"GPU").toUpperCase()})`:gt=me;async function Pu(){for(Me("Loading OpenCV...");typeof cv>"u";)await new Promise(n=>setTimeout(n,100));Me("OpenCV Loaded. Loading Dictionary..."),gn=(await(await fetch($t.dic)).text()).split(`
`),gn.push(" "),yu(gt);const s=Ba&&fr.hasModelParam&&fr.hasDeviceParam;Me(s?"Ready. Processing URL image...":"Ready. Upload image."),Tu({onUpload:async n=>{await fn(n)},onExampleClick:async()=>{await fn("https://ibelem.github.io/webnn-hf-spaces/on-device-ocr/assets/invoice.jpg")},onModelChange:n=>{const u=new URL(window.location.href);u.searchParams.set("model",n),window.location.href=u.toString()},modelVersion:Ro}),s&&await fn(Ba)}async function La(r){if(r==="det"&&rr)return rr;if(r==="rec"&&nr)return nr;Me(`Loading ${r} model (${me})...`);const a={executionProviders:[me]};if(me.startsWith("webnn")){const p=me.includes("-")?me.split("-")[1]:"gpu";a.executionProviders=[{name:"webnn",deviceType:p,powerPreference:"default"}]}else me==="webgpu"?a.executionProviders=[{name:me,deviceType:"gpu",powerPreference:"default"}]:a.executionProviders=[{name:me,deviceType:"cpu",powerPreference:"default"}];const s=r==="det"?$t.det:$t.rec;let n=performance.now();const u=await bn.create(s,a),d=performance.now()-n;return r==="det"?(ur("detCom",d),console.log(`Detection model compilation time: ${d.toFixed(2)}ms`)):(ur("recCom",d),console.log(`Recognition model compilation time: ${d.toFixed(2)}ms`)),r==="det"&&rr===null?rr=u:r==="rec"&&nr===null&&(nr=u),u}async function fn(r){try{Me("Processing image..."),vu();const a=await _u(r);wu(a.src);const s=await La("det");Me("Running Detection...");const{tensor:n,width:u,height:c,originalWidth:d,originalHeight:p,imageData:m}=xu(a),g={};g[s.inputNames[0]]=n;const v=performance.now(),C=await s.run(g),I=performance.now()-v;ur("detInf",I),console.log(`Detection inference time: ${I.toFixed(2)}ms`);const O=C[s.outputNames[0]],$=Eu(O,u,c);Me("Splitting lines...");const S=Iu($,a);Su(q.canvasOverlay,d,p,S),Me("Running Recognition...");const A=await La("rec");let P="";un=0;for(let D=0;D<S.length;D++){const L=S[D],N=Au(L.mat),te={};te[A.inputNames[0]]=N;const le=performance.now(),Y=await A.run(te),re=performance.now()-le;console.log(`Recognition inference time (line ${D+1}): ${re.toFixed(2)}ms`),un+=re;const J=Y[A.outputNames[0]],{text:V,meanProb:ye}=Ru(J,gn);ye>.3?(P+=V+`
`,bu(V,ye)):console.log(`Low confidence line skipped: "${V}" (${ye.toFixed(2)})`),L.mat.delete()}ur("recInf",un),Me(`${gt} OCR complete.`),console.log(`OCR Result:
`,P)}catch(a){console.error(a),Me(`Error: ${a.message}`)}}Pu();
